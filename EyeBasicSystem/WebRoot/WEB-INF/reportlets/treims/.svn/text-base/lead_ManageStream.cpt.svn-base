<?xml version="1.0" encoding="UTF-8"?>
<WorkBook xmlVersion="20120529" releaseVersion="7.0.0">
<TableDataMap>
<TableData name="ds1" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="logincompanyid"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select 
*
from F_CompanyName
where F_CN_ID = '${logincompanyid}']]></Query>
</TableData>
<TableData name="ds2" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="queryYear"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="queryMonth"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select top 1 ('${queryMonth}'+'月') as queryDate,('${queryYear}'+'年') as queryYear,(cast(year(dateadd(yy,-1,'${queryYear}')) as varchar)+'年') as lastYear]]></Query>
</TableData>
<TableData name="ds3" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="queryYear"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="queryMonth"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[DECLARE @lastYear VARCHAR(10) -- 去年年份
SET @lastYear=YEAR(Dateadd(yy, -1, '${queryYear}'))

DECLARE @queryDate VARCHAR(10),
        @lastDate  VARCHAR(10)

SET @queryDate='${queryYear}' + '-' + '${queryMonth}'
SET @lastDate=@lastYear + '-' + '${queryMonth}'

select * into #R_SD_DayCollectEntry from(
select newid()	as	R_SD_DCE_ID,
@queryDate	as	R_SD_DCE_Date,
bm.B_DP_DepartmentID	as	R_SD_DCE_ShopCode,
bm.B_DP_DepartmentName	as	R_SD_DCE_ShopName,
tempcount1.Numbercount	as	R_SD_DCE_GlassesFrameNum,
tempcount1.SalseValue	as	R_SD_DCE_GlassesFrameAmount,
tempcount1.PriceSum	as	R_SD_DCE_GlassesFramePriceAmount,
tempcount1.DiscountNum	as	R_SD_DCE_GlassesFrameDiscountAmount,
tempcount1.CostsPrive	as	R_SD_DCE_GlassesFrameRateAmount,
tempcount1.AverageNotTaxRate	as	R_SD_DCE_GlassesFrameAvgAmount,
tempcount1.UnitPrice	as	R_SD_DCE_GlassesFrameNotRateAmount,
tempcount2.Numbercount	as	R_SD_DCE_AccessoriesNum,
tempcount2.SalseValue	as	R_SD_DCE_AccessoriesAmount,
tempcount2.PriceSum	as	R_SD_DCE_AccessoriesPriceAmount,
tempcount2.DiscountNum	as	R_SD_DCE_AccessoriesDiscountAmount,
tempcount2.CostsPrive	as	R_SD_DCE_AccessoriesRateAmount,
tempcount2.AverageNotTaxRate	as	R_SD_DCE_AccessoriesAvgAmount,
tempcount2.UnitPrice	as	R_SD_DCE_AccessoriesNotRateAmount,
tempcount3.Numbercount	as	R_SD_DCE_LensNum,
tempcount3.SalseValue	as	R_SD_DCE_LensAmount,
tempcount3.PriceSum	as	R_SD_DCE_LensPriceAmount,
tempcount3.DiscountNum	as	R_SD_DCE_LensDiscountAmount,
tempcount3.CostsPrive	as	R_SD_DCE_LensRateAmount,
tempcount3.AverageNotTaxRate	as	R_SD_DCE_LensAvgAmount,
tempcount3.UnitPrice	as	R_SD_DCE_LensNotRateAmount,
tempcount4.Numbercount	as	R_SD_DCE_stealthNum,
tempcount4.SalseValue	as	R_SD_DCE_stealthAmount,
tempcount4.PriceSum	as	R_SD_DCE_stealthPriceAmount,
tempcount4.DiscountNum	as	R_SD_DCE_stealthDiscountAmount,
tempcount4.CostsPrive	as	R_SD_DCE_stealthRateAmount,
tempcount4.AverageNotTaxRate	as	R_SD_DCE_stealthAvgAmount,
tempcount4.UnitPrice	as	R_SD_DCE_stealthNotRateAmount,
tempcount5.Numbercount	as	R_SD_DCE_stealthAccNum,
tempcount5.SalseValue	as	R_SD_DCE_stealthAccAmount,
tempcount5.PriceSum	as	R_SD_DCE_stealthAccPriceAmount,
tempcount5.DiscountNum	as	R_SD_DCE_stealthAccDiscountAmount,
tempcount5.CostsPrive	as	R_SD_DCE_stealthAccRateAmount,
tempcount5.AverageNotTaxRate	as	R_SD_DCE_stealthAccAvgAmount,
tempcount5.UnitPrice	as	R_SD_DCE_stealthAccNotRateAmount,
tempcount6.Numbercount	as	R_SD_DCE_SunGlassesNum,
tempcount6.SalseValue	as	R_SD_DCE_SunGlassesAmount,
tempcount6.PriceSum	as	R_SD_DCE_SunGlassesPriceAmount,
tempcount6.DiscountNum	as	R_SD_DCE_SunGlassesDiscountAmount,
tempcount6.CostsPrive	as	R_SD_DCE_SunGlassesRateAmount,
tempcount6.AverageNotTaxRate	as	R_SD_DCE_SunGlassesAvgAmount,
tempcount6.UnitPrice	as	R_SD_DCE_SunGlassesNotRateAmount,
tempcount8.Numbercount	as	R_SD_DCE_PresbyopicGlassesNum,
tempcount8.SalseValue	as	R_SD_DCE_PresbyopicGlassesAmount,
tempcount8.PriceSum	as	R_SD_DCE_PresbyopicGlassesPriceAmount,
tempcount8.DiscountNum	as	R_SD_DCE_PresbyopicGlassesDiscountAmount,
tempcount8.CostsPrive	as	R_SD_DCE_PresbyopicGlassesRateAmount,
tempcount8.AverageNotTaxRate	as	R_SD_DCE_PresbyopicGlassesAvgAmount,
tempcount8.UnitPrice	as	R_SD_DCE_PresbyopicGlassesNotRateAmount,
tempcount7.Numbercount	as	R_SD_DCE_OtherGoodsNum,
tempcount7.SalseValue	as	R_SD_DCE_OtherGoodsAmount,
tempcount7.PriceSum	as	R_SD_DCE_OtherGoodsPriceAmount,
tempcount7.DiscountNum	as	R_SD_DCE_OtherGoodsDiscountAmount,
tempcount7.CostsPrive	as	R_SD_DCE_OtherGoodsRateAmount,
tempcount7.AverageNotTaxRate	as	R_SD_DCE_OtherGoodsAvgAmount,
tempcount7.UnitPrice	as	R_SD_DCE_OtherGoodsNotRateAmount,
tempcount9.Numbercount	as	R_SD_DCE_VisualOpticsNum,
tempcount9.SalseValue	as	R_SD_DCE_VisualOpticsAmount,
tempcount9.PriceSum	as	R_SD_DCE_VisualOpticsPriceAmount,
tempcount9.DiscountNum	as	R_SD_DCE_VisualOpticsDiscountAmount,
tempcount9.CostsPrive	as	R_SD_DCE_VisualOpticsRateAmount,
tempcount9.AverageNotTaxRate	as	R_SD_DCE_VisualOpticsAvgAmount,
tempcount9.UnitPrice	as	R_SD_DCE_VisualOpticsNotRateAmount,
''	as	R_SD_DCE_WithdrawFlag

from (
select B_DP_DepartmentID,B_DP_DepartmentName from B_Departments
-- where B_DP_DepartmentID=@departmentid
) bm
left join 
----镜架类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='1'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='1'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode

) temp1  group by S_SE_SB_ShopCode 
)tempcount1 on tempcount1.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----镜架类统计------------------------------------------------
left join 
----配件类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='2'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='2'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp2  group by S_SE_SB_ShopCode 
)tempcount2 on tempcount2.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----配件类统计------------------------------------------------
left join 
----镜片类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='3'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='3'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp3  group by S_SE_SB_ShopCode 
)tempcount3 on tempcount3.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----镜片类统计------------------------------------------------
left join 
----隐形镜片类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='4'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='4'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp4  group by S_SE_SB_ShopCode 
)tempcount4 on tempcount4.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----隐形镜片类统计------------------------------------------------
left join 
----隐形护理液类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='5'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='5'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode

) temp5  group by S_SE_SB_ShopCode 
)tempcount5 on tempcount5.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----隐形护理液类统计------------------------------------------------
left join 
----太阳镜类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='6'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='6'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp6  group by S_SE_SB_ShopCode 
)tempcount6 on tempcount6.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----太阳镜类统计------------------------------------------------
left join 
----老花镜类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
 and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
 and substring(S_SE_SD_SalesItemID,1,1) ='8'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
 and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
 and substring(S_SE_SD_SalesItemID,1,1) ='8'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp8  group by S_SE_SB_ShopCode 
)tempcount8 on tempcount8.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----老花镜类统计------------------------------------------------
left join 
----耗材类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='7'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='7'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
) temp7  group by S_SE_SB_ShopCode 
)tempcount7 on tempcount7.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----耗材类统计------------------------------------------------
left join 
----视光类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail 
inner join S_SE_Salesbasic on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='9'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
  from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_SE_Sb_SalesID and S_SE_SB_ValueFlag = 1 
inner join B_GoodsInfo on B_GI_GoodsID = S_SE_SD_SalesItemID
 where 1=1
   and B_GI_SupplierID<>'ZZ'  
 and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='9'
 --and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120)=@queryDate
 group by S_SE_SB_ShopCode

) temp9  group by S_SE_SB_ShopCode 
)tempcount9 on tempcount9.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----视光类统计------------------------------------------------

union all 

select newid()	as	R_SD_DCE_ID,
@queryDate	as	R_SD_DCE_Date,
bm.B_DP_DepartmentID	as	R_SD_DCE_ShopCode,
bm.B_DP_DepartmentName	as	R_SD_DCE_ShopName,
tempcount1.Numbercount	as	R_SD_DCE_GlassesFrameNum,
tempcount1.SalseValue	as	R_SD_DCE_GlassesFrameAmount,
tempcount1.PriceSum	as	R_SD_DCE_GlassesFramePriceAmount,
tempcount1.DiscountNum	as	R_SD_DCE_GlassesFrameDiscountAmount,
tempcount1.CostsPrive	as	R_SD_DCE_GlassesFrameRateAmount,
tempcount1.AverageNotTaxRate	as	R_SD_DCE_GlassesFrameAvgAmount,
tempcount1.UnitPrice	as	R_SD_DCE_GlassesFrameNotRateAmount,
tempcount2.Numbercount	as	R_SD_DCE_AccessoriesNum,
tempcount2.SalseValue	as	R_SD_DCE_AccessoriesAmount,
tempcount2.PriceSum	as	R_SD_DCE_AccessoriesPriceAmount,
tempcount2.DiscountNum	as	R_SD_DCE_AccessoriesDiscountAmount,
tempcount2.CostsPrive	as	R_SD_DCE_AccessoriesRateAmount,
tempcount2.AverageNotTaxRate	as	R_SD_DCE_AccessoriesAvgAmount,
tempcount2.UnitPrice	as	R_SD_DCE_AccessoriesNotRateAmount,
tempcount3.Numbercount	as	R_SD_DCE_LensNum,
tempcount3.SalseValue	as	R_SD_DCE_LensAmount,
tempcount3.PriceSum	as	R_SD_DCE_LensPriceAmount,
tempcount3.DiscountNum	as	R_SD_DCE_LensDiscountAmount,
tempcount3.CostsPrive	as	R_SD_DCE_LensRateAmount,
tempcount3.AverageNotTaxRate	as	R_SD_DCE_LensAvgAmount,
tempcount3.UnitPrice	as	R_SD_DCE_LensNotRateAmount,
tempcount4.Numbercount	as	R_SD_DCE_stealthNum,
tempcount4.SalseValue	as	R_SD_DCE_stealthAmount,
tempcount4.PriceSum	as	R_SD_DCE_stealthPriceAmount,
tempcount4.DiscountNum	as	R_SD_DCE_stealthDiscountAmount,
tempcount4.CostsPrive	as	R_SD_DCE_stealthRateAmount,
tempcount4.AverageNotTaxRate	as	R_SD_DCE_stealthAvgAmount,
tempcount4.UnitPrice	as	R_SD_DCE_stealthNotRateAmount,
tempcount5.Numbercount	as	R_SD_DCE_stealthAccNum,
tempcount5.SalseValue	as	R_SD_DCE_stealthAccAmount,
tempcount5.PriceSum	as	R_SD_DCE_stealthAccPriceAmount,
tempcount5.DiscountNum	as	R_SD_DCE_stealthAccDiscountAmount,
tempcount5.CostsPrive	as	R_SD_DCE_stealthAccRateAmount,
tempcount5.AverageNotTaxRate	as	R_SD_DCE_stealthAccAvgAmount,
tempcount5.UnitPrice	as	R_SD_DCE_stealthAccNotRateAmount,
tempcount6.Numbercount	as	R_SD_DCE_SunGlassesNum,
tempcount6.SalseValue	as	R_SD_DCE_SunGlassesAmount,
tempcount6.PriceSum	as	R_SD_DCE_SunGlassesPriceAmount,
tempcount6.DiscountNum	as	R_SD_DCE_SunGlassesDiscountAmount,
tempcount6.CostsPrive	as	R_SD_DCE_SunGlassesRateAmount,
tempcount6.AverageNotTaxRate	as	R_SD_DCE_SunGlassesAvgAmount,
tempcount6.UnitPrice	as	R_SD_DCE_SunGlassesNotRateAmount,
tempcount8.Numbercount	as	R_SD_DCE_PresbyopicGlassesNum,
tempcount8.SalseValue	as	R_SD_DCE_PresbyopicGlassesAmount,
tempcount8.PriceSum	as	R_SD_DCE_PresbyopicGlassesPriceAmount,
tempcount8.DiscountNum	as	R_SD_DCE_PresbyopicGlassesDiscountAmount,
tempcount8.CostsPrive	as	R_SD_DCE_PresbyopicGlassesRateAmount,
tempcount8.AverageNotTaxRate	as	R_SD_DCE_PresbyopicGlassesAvgAmount,
tempcount8.UnitPrice	as	R_SD_DCE_PresbyopicGlassesNotRateAmount,
tempcount7.Numbercount	as	R_SD_DCE_OtherGoodsNum,
tempcount7.SalseValue	as	R_SD_DCE_OtherGoodsAmount,
tempcount7.PriceSum	as	R_SD_DCE_OtherGoodsPriceAmount,
tempcount7.DiscountNum	as	R_SD_DCE_OtherGoodsDiscountAmount,
tempcount7.CostsPrive	as	R_SD_DCE_OtherGoodsRateAmount,
tempcount7.AverageNotTaxRate	as	R_SD_DCE_OtherGoodsAvgAmount,
tempcount7.UnitPrice	as	R_SD_DCE_OtherGoodsNotRateAmount,
tempcount9.Numbercount	as	R_SD_DCE_VisualOpticsNum,
tempcount9.SalseValue	as	R_SD_DCE_VisualOpticsAmount,
tempcount9.PriceSum	as	R_SD_DCE_VisualOpticsPriceAmount,
tempcount9.DiscountNum	as	R_SD_DCE_VisualOpticsDiscountAmount,
tempcount9.CostsPrive	as	R_SD_DCE_VisualOpticsRateAmount,
tempcount9.AverageNotTaxRate	as	R_SD_DCE_VisualOpticsAvgAmount,
tempcount9.UnitPrice	as	R_SD_DCE_VisualOpticsNotRateAmount,
'1'	as	R_SD_DCE_WithdrawFlag

from (
select B_DP_DepartmentID,B_DP_DepartmentName from B_Departments
-- where B_DP_DepartmentID=@departmentid
) bm
left join 
----镜架类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (	
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='1'
--and S_SE_SB_ShopCode=@departmentid

and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='1'
--and S_SE_SB_ShopCode=@departmentid

and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp1  group by S_SE_SB_ShopCode 
)tempcount1 on tempcount1.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----镜架类统计------------------------------------------------
left join 
----配件类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (	
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='2'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='2'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp2  group by S_SE_SB_ShopCode 
)tempcount2 on tempcount2.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----配件类统计------------------------------------------------
left join 
----镜片类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='3'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='3'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp3  group by S_SE_SB_ShopCode 
)tempcount3 on tempcount3.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----镜片类统计------------------------------------------------
left join 
----隐形镜片类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='4'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='4'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
) temp4  group by S_SE_SB_ShopCode 
)tempcount4 on tempcount4.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----隐形镜片类统计------------------------------------------------
left join 
----隐形护理液类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (	
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='5'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='5'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp5  group by S_SE_SB_ShopCode 
)tempcount5 on tempcount5.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----隐形护理液类统计------------------------------------------------
left join 
----太阳镜类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='6'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='6'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp6  group by S_SE_SB_ShopCode 
)tempcount6 on tempcount6.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----太阳镜类统计------------------------------------------------
left join 
----老花镜类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='8'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='8'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp8  group by S_SE_SB_ShopCode 
)tempcount8 on tempcount8.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----老花镜类统计------------------------------------------------
left join 
----耗材类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='7'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='7'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp7  group by S_SE_SB_ShopCode 
)tempcount7 on tempcount7.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----耗材类统计------------------------------------------------
left join 
----视光类统计------------------------------------------------
(select S_SE_SB_ShopCode as S_SE_SB_ShopCode,
sum(cast(S_SE_SD_Number as numeric(20, 0))) as  Numbercount,
sum(cast(SalseValue as numeric(20, 2))) as SalseValue,
sum(cast(PriceSum as numeric(20, 2))) as PriceSum,
sum(cast(DiscountNum as numeric(20, 2))) as DiscountNum,
sum(cast(CostsPrive as numeric(20, 2))) as CostsPrive,
sum(cast(AverageNotTaxRate as numeric(20, 2))) as AverageNotTaxRate,
sum(cast(UnitPrice as numeric(20, 2))) as UnitPrice
from (	
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_se_SalesDetail 
inner join S_se_SalesBasic on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='9'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode
union all
select S_SE_SB_ShopCode,-sum(cast(S_SE_SD_Number as numeric(20, 2))) as S_SE_SD_Number,
-sum(cast(S_SE_SD_SalesValue as numeric(20, 2))) as SalseValue,
-sum(cast(S_SE_SD_PriceSum as numeric(20, 2))) as PriceSum,
-sum(cast(S_SE_SD_PriceSum-S_SE_SD_SalesValue as numeric(20, 2))) as DiscountNum,
-sum(cast(S_SE_SD_CostsPrive*S_SE_SD_Number as numeric(20, 2))) as CostsPrive,
-sum(cast(B_GI_AverageNotTaxRate*S_SE_SD_Number as numeric(20, 2))) as AverageNotTaxRate,
-sum(cast(S_SE_SD_UnitPrice*S_SE_SD_Number as numeric(20, 2))) as UnitPrice
from S_SE_SalesDetail_Finished 
inner join S_SE_SalesBasic_Finished on S_SE_SD_SalesID = S_se_sb_Salesid and S_SE_SB_ValueFlag = 1 
inner join b_goodsinfo on B_GI_GoodsID = S_SE_SD_SalesItemID
where  1=1
and B_GI_SupplierID<>'ZZ'  -- 去掉顾客自片/单眼片
and S_SE_SB_WithdrawFlag='1'-- 退款表示1  
and S_SE_SB_ValueFlag='1'
and substring(S_SE_SD_SalesItemID,1,1) ='9'
--and S_SE_SB_ShopCode=@departmentid
and CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120)=@queryDate
group by S_SE_SB_ShopCode

) temp9  group by S_SE_SB_ShopCode 
)tempcount9 on tempcount9.S_SE_SB_ShopCode = bm.B_DP_DepartmentID
----视光类统计------------------------------------------------
)t

SELECT B_DP_DepartmentName as mendian,
       TEMP.ShopCode,
       SUM(bzongjine+new_add.amount)	         AS bzongjine,
       SUM(bjjje)              AS bjjje,
       SUM(byxje)              AS byxje,
       SUM(now_pjs.Salsecount) AS bjjpjs,
       SUM(ygs_now.ygFNum)     AS bjjygs,
       SUM(qzongjine+ago_add.amount)	        AS qzongjine,
       SUM(qjjje)              AS qjjje,
       SUM(qyxje)              AS qyxje,
       SUM(ago_pjs.Salsecount) AS qjjpjs,
       SUM(ygs_ago.ygFNum)     AS qjjygs,
	   SUM(new_add.amount)	   AS bfujiafei,
	   SUM(ago_add.amount)	   AS qfujiafei
FROM   (
	select	ShopCode as ShopCode,
			sum(bzongjine) as bzongjine,
			sum(bjjje) as bjjje,
			sum(byxje) as byxje,
			sum(qzongjine) as qzongjine,
			sum(qjjje) as qjjje,
			sum(qyxje) as qyxje
	from(
		SELECT R_SD_DCE_ShopCode                            AS ShopCode,
               Isnull(SUM(( Isnull(R_SD_DCE_GlassesFrameAmount, 0) + Isnull(R_SD_DCE_AccessoriesAmount, 0) + Isnull(R_SD_DCE_LensAmount, 0) + Isnull(R_SD_DCE_stealthAmount, 0) + Isnull(R_SD_DCE_stealthAccAmount, 0) + Isnull(R_SD_DCE_SunGlassesAmount, 0) + Isnull(R_SD_DCE_OtherGoodsAmount, 0) )), 0)  AS bzongjine,
               Isnull(SUM(Isnull(R_SD_DCE_GlassesFrameAmount, 0) + Isnull(R_SD_DCE_LensAmount, 0)), 0)         AS bjjje,
               Isnull(SUM(Isnull(R_SD_DCE_stealthAmount, 0) + Isnull(R_SD_DCE_stealthAccAmount, 0)), 0)        AS byxje,
               0                                           AS qzongjine,
               0                                           AS qjjje,
               0                                           AS qyxje
        FROM   #R_SD_DayCollectEntry
        WHERE  CONVERT(VARCHAR(7), R_SD_DCE_Date, 120) = @queryDate
        GROUP  BY R_SD_DCE_ShopCode
        UNION ALL
        SELECT R_SD_DCE_ShopCode                            AS ShopCode,
               0                                           AS bzongjine,
               0                                           AS bjjje,
               0                                           AS byxje,
               Isnull(SUM(( Isnull(R_SD_DCE_GlassesFrameAmount, 0) + Isnull(R_SD_DCE_AccessoriesAmount, 0) + Isnull(R_SD_DCE_LensAmount, 0) + Isnull(R_SD_DCE_stealthAmount, 0) + Isnull(R_SD_DCE_stealthAccAmount, 0) + Isnull(R_SD_DCE_SunGlassesAmount, 0) + Isnull(R_SD_DCE_OtherGoodsAmount, 0) )), 0) AS qzongjine,
               Isnull(SUM(Isnull(R_SD_DCE_GlassesFrameAmount, 0) + Isnull(R_SD_DCE_LensAmount, 0)), 0)         AS qjjje,
               Isnull(SUM(Isnull(R_SD_DCE_stealthAmount, 0) + Isnull(R_SD_DCE_stealthAccAmount, 0)), 0)       AS qyxje
        FROM   R_SD_DayCollectEntry
        WHERE  CONVERT(VARCHAR(7), R_SD_DCE_Date, 120) = @lastDate
        GROUP  BY R_SD_DCE_ShopCode
	) shiying
	group by ShopCode

)TEMP
		left join dbo.B_Departments on TEMP.ShopCode = B_DP_DepartmentID
       LEFT JOIN (
			select	ShopCode as ShopCode,
					sum(ygFNum) as ygFNum
				from (
					select temp.shopcode as ShopCode,sum(temp.ygFNum) as ygFNum from(
						SELECT S_OP_R_shopcode as shopcode,
							   CONVERT(VARCHAR(10), S_OP_R_Inspection_date, 23) as date,
							   Isnull(COUNT(distinct S_OP_R_CustomerID), 0) AS ygFNum 
						FROM   dbo.S_OP_Refractive
						Where  S_OP_R_DiffusePupil <> '10'
						  and  isnull(S_OP_R_DiffusePupil,'') <> ''
						GROUP  BY S_OP_R_shopcode,
								  CONVERT(VARCHAR(10), S_OP_R_Inspection_date, 23) 
					)temp
					where convert(varchar(7),date,23) = @queryDate
					group by temp.shopcode
				) temp 
				group by ShopCode
		) ygs_now
         ON ygs_now.shopcode = TEMP.ShopCode
       LEFT JOIN (
			select	ShopCode as ShopCode,
					sum(ygFNum) as ygFNum
				from (
					select temp.shopcode as ShopCode,sum(temp.ygFNum) as ygFNum from(
						SELECT S_OP_R_shopcode as shopcode,
							   CONVERT(VARCHAR(10), S_OP_R_Inspection_date, 23) as date,
							   Isnull(COUNT(distinct S_OP_R_CustomerID), 0) AS ygFNum 
						FROM   dbo.S_OP_Refractive
						Where  S_OP_R_DiffusePupil <> '10'
						  and  isnull(S_OP_R_DiffusePupil,'') <> ''
						GROUP  BY S_OP_R_shopcode,
								  CONVERT(VARCHAR(10), S_OP_R_Inspection_date, 23) 
					)temp
					where convert(varchar(7),date,23) = @lastDate
					group by temp.shopcode
				) temp 
				group by ShopCode
		) ygs_ago
         ON ygs_ago.shopcode = TEMP.ShopCode

left join (
					select ShopCode as ShopCode,sum(Salsecount) as Salsecount from(
						SELECT S_SE_SB_ShopCode as ShopCode,
                               sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_Salesbasic
						 INNER JOIN S_SE_SalesDetail ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @queryDate
                         GROUP BY S_SE_SB_ShopCode
						union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               -sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_Salesbasic
						 INNER JOIN S_SE_SalesDetail ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_WithdrawFlag = '1'-- 退款
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @queryDate
						 GROUP BY S_SE_SB_ShopCode
                        union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_SalesBasic_Finished
						 INNER JOIN S_SE_SalesDetail_Finished ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @queryDate
                         GROUP BY S_SE_SB_ShopCode
						union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               -sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_SalesBasic_Finished
						 INNER JOIN S_SE_SalesDetail_Finished ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_WithdrawFlag = '1'-- 退款
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @queryDate
						 GROUP BY S_SE_SB_ShopCode
					)npjs group by npjs.ShopCode
) now_pjs
		ON now_pjs.shopcode = TEMP.ShopCode
left join (
					select ShopCode as ShopCode,sum(Salsecount) as Salsecount from(
						SELECT S_SE_SB_ShopCode as ShopCode,
                               sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_Salesbasic
						 left JOIN S_SE_SalesDetail ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @lastDate
                         GROUP BY S_SE_SB_ShopCode
						union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               -sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_Salesbasic	
						 left JOIN S_SE_SalesDetail ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_WithdrawFlag = '1'-- 退款
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @lastDate
						 GROUP BY S_SE_SB_ShopCode
                        union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_SalesBasic_Finished
						 left JOIN S_SE_SalesDetail_Finished ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @lastDate
                         GROUP BY S_SE_SB_ShopCode
						union all
						SELECT S_SE_SB_ShopCode as ShopCode,
                               -sum(S_SE_SD_Number) AS Salsecount
                          FROM S_SE_SalesBasic_Finished	
						 left JOIN S_SE_SalesDetail_Finished ON S_SE_SD_SalesID = S_SE_SB_SalesID
                         WHERE 1 = 1
                           AND S_SE_SB_WithdrawFlag = '1'-- 退款
                           AND S_SE_SB_ValueFlag = '1'
						   and S_SE_SD_CommoditiesFlag = '1'
						   AND CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @lastDate
						 GROUP BY S_SE_SB_ShopCode

					)opjs group by opjs.ShopCode
) ago_pjs
		ON ago_pjs.shopcode = TEMP.ShopCode

LEFT JOIN(SELECT ShopCode       AS ShopCode,
                        SUM(TEMP.amount) AS amount
                 FROM   (
                         SELECT 
                                s_se_sb_posid,
                                CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_se_SalesBasic.S_SE_SB_ShopCode as ShopCode
                         FROM   S_se_SalesBasic
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = S_se_SalesBasic.s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @lastDate
                                AND S_se_SalesBasic.s_se_sb_ValueFlag = '1'
                         UNION ALL
                         SELECT 
                                S_se_SalesBasic.S_SE_SB_WithdrawPersonID                                                AS posid,
                                -CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_se_SalesBasic.S_SE_SB_ShopCode as ShopCode
                         FROM   S_se_SalesBasic
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @lastDate
                                AND S_se_SalesBasic.s_se_sb_ValueFlag = '1'
                                AND s_se_sb_withdrawflag = 1
                         union all
                         SELECT 
                                s_se_sb_posid,
                                CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_SE_SB_ShopCode as ShopCode
                         FROM   S_SE_SalesBasic_Finished
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @lastDate
                                AND s_se_sb_ValueFlag = '1'
                         UNION ALL
                         SELECT 
                                S_SE_SB_WithdrawPersonID                                                AS posid,
                                -CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_SE_SB_ShopCode as ShopCode
                         FROM   S_SE_SalesBasic_Finished
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @lastDate
                                AND s_se_sb_ValueFlag = '1'
                                AND s_se_sb_withdrawflag = 1
                 )TEMP
                 GROUP  BY ShopCode)ago_add
         ON TEMP.ShopCode = ago_add.ShopCode

LEFT JOIN(SELECT ShopCode       AS ShopCode,
                        SUM(TEMP.amount) AS amount
                 FROM   (
                         SELECT 
                                s_se_sb_posid,
                                CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_se_SalesBasic.S_SE_SB_ShopCode as ShopCode
                         FROM   S_se_SalesBasic
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = S_se_SalesBasic.s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @queryDate
                                AND S_se_SalesBasic.s_se_sb_ValueFlag = '1'
                         UNION ALL
                         SELECT 
                                S_se_SalesBasic.S_SE_SB_WithdrawPersonID                                                AS posid,
                                -CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_se_SalesBasic.S_SE_SB_ShopCode as ShopCode
                         FROM   S_se_SalesBasic
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = S_se_SalesBasic.s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @queryDate
                                AND S_se_SalesBasic.s_se_sb_ValueFlag = '1'
                                AND s_se_sb_withdrawflag = 1
                         union all
                         SELECT 
                                s_se_sb_posid,
                                CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_SE_SB_ShopCode as ShopCode
                         FROM   S_SE_SalesBasic_Finished
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_PosDatetime, 120) = @queryDate
                                AND s_se_sb_ValueFlag = '1'
                         UNION ALL
                         SELECT 
                                S_SE_SB_WithdrawPersonID                                                AS posid,
                                -CAST(Isnull(S_SE_AdditionalCDetail.S_SE_Amount * S_SE_Number, '0.0')AS DECIMAL(18, 2)) AS amount,
                                S_SE_SB_ShopCode as ShopCode
                         FROM   S_SE_SalesBasic_Finished
                                LEFT JOIN S_SE_AdditionalCDetail
                                  ON S_SE_AdditionalCDetail.S_SE_SalesID = s_se_sb_salesid
						 WHERE  CONVERT(VARCHAR(7), S_SE_SB_WithdrawDate, 120) = @queryDate
                                AND s_se_sb_ValueFlag = '1'
                                AND s_se_sb_withdrawflag = 1
                 )TEMP
                 GROUP  BY ShopCode)new_add
         ON TEMP.ShopCode = new_add.ShopCode
GROUP  BY TEMP.ShopCode,
          B_DP_DepartmentName
ORDER  BY B_DP_DepartmentName 

drop table #R_SD_DayCollectEntry]]></Query>
</TableData>
</TableDataMap>
<Report class="com.fr.report.WorkSheet" name="sheet1">
<ReportPageAttr>
<HR F="3" T="4"/>
<FR F="7" T="7"/>
<HC/>
<FC/>
</ReportPageAttr>
<RowHeight defaultValue="723900">
<![CDATA[1143000,1143000,990600,1143000,990600,990600,990600,723900,723900,723900,723900]]></RowHeight>
<ColumnWidth defaultValue="2743200">
<![CDATA[1905000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,3810000,2743200]]></ColumnWidth>
<CellElementList>
<C c="0" r="0" cs="26" s="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="F_CN_ReportShowName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="27" r="0" s="1">
<Expand/>
</C>
<C c="0" r="1" cs="26" s="2">
<O>
<![CDATA[经营流水报表]]></O>
<Expand/>
</C>
<C c="27" r="1" s="1">
<Expand/>
</C>
<C c="0" r="2" s="3">
<O>
<![CDATA[月份：]]></O>
<Expand/>
</C>
<C c="1" r="2" cs="3" s="4">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryDate"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="4" r="2">
<Expand/>
</C>
<C c="5" r="2">
<Expand/>
</C>
<C c="6" r="2">
<Expand/>
</C>
<C c="7" r="2">
<Expand/>
</C>
<C c="8" r="2">
<Expand/>
</C>
<C c="9" r="2">
<Expand/>
</C>
<C c="10" r="2">
<Expand/>
</C>
<C c="11" r="2">
<Expand/>
</C>
<C c="12" r="2">
<Expand/>
</C>
<C c="13" r="2">
<Expand/>
</C>
<C c="14" r="2">
<Expand/>
</C>
<C c="15" r="2">
<Expand/>
</C>
<C c="16" r="2">
<Expand/>
</C>
<C c="17" r="2">
<Expand/>
</C>
<C c="18" r="2">
<Expand/>
</C>
<C c="19" r="2">
<Expand/>
</C>
<C c="20" r="2">
<Expand/>
</C>
<C c="21" r="2">
<Expand/>
</C>
<C c="22" r="2">
<Expand/>
</C>
<C c="23" r="2">
<Expand/>
</C>
<C c="24" r="2">
<Expand/>
</C>
<C c="25" r="2">
<Expand/>
</C>
<C c="27" r="2" s="1">
<Expand/>
</C>
<C c="0" r="3" cs="2" rs="2" s="5">
<O>
<![CDATA[门店名称]]></O>
<Expand/>
</C>
<C c="2" r="3" cs="4" s="5">
<O>
<![CDATA[总销售流水（元）]]></O>
<Expand/>
</C>
<C c="6" r="3" cs="4" s="5">
<O>
<![CDATA[框架眼镜流水（元）]]></O>
<Expand/>
</C>
<C c="10" r="3" cs="4" s="5">
<O>
<![CDATA[隐形眼镜流水（元）]]></O>
<Expand/>
</C>
<C c="14" r="3" cs="4" s="5">
<O>
<![CDATA[框架眼镜配镜副数]]></O>
<Expand/>
</C>
<C c="18" r="3" cs="4" s="5">
<O>
<![CDATA[框架眼镜平均单价]]></O>
<Expand/>
</C>
<C c="22" r="3" cs="4" s="5">
<O>
<![CDATA[验光人次]]></O>
<Expand/>
</C>
<C c="26" r="3" cs="2" s="5">
<O>
<![CDATA[附加费]]></O>
<Expand/>
</C>
<C c="2" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="3" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="4" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="5" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="6" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="7" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="8" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="9" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="10" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="11" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="12" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="13" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="14" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="15" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="16" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="17" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="18" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="19" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="20" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="21" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="22" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="23" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="24" r="4" s="5">
<O>
<![CDATA[增长]]></O>
<Expand/>
</C>
<C c="25" r="4" s="5">
<O>
<![CDATA[增幅]]></O>
<Expand/>
</C>
<C c="26" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="lastYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="27" r="4" s="5">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="queryYear"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="0" r="5" cs="2" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="mendian"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="2" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qzongjine"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if(FuncOne($$$)=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="3" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="bzongjine"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if(FuncOne($$$)=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="4" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(C6 = "" || D6 = "", "", FuncOne(D6 - C6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="5" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(C6 = "" || D6 = "", "", CONCATENATE(FuncOne((D6 - C6) / C6 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="6" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qjjje"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="7" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="bjjje"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="8" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(H6 = "" || G6 = "", "", FuncOne(H6 - G6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="9" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(H6 = "" || G6 = "", "", CONCATENATE(FuncOne((H6 - G6) / G6 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="10" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qyxje"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="11" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="byxje"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",FuncOne($$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="12" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(L6 = "" || K6 = "", "", FuncOne(L6 - K6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="13" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(L6 = "" || K6 = "", "", CONCATENATE(FuncOne((L6 - K6) / K6 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="14" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qjjpjs"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="15" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="bjjpjs"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="16" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(TRIM(P6) = "" || TRIM(O6) = "", "", P6 - O6)]]></Attributes>
</O>
<Expand/>
</C>
<C c="17" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(OR((P6 - O6) / O6 * 100 = 0, TRIM(P6) = "", TRIM(O6) = ""), "", CONCATENATE(FuncOne((P6 - O6) / O6 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="18" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(O6) = "" || trim(O6) = "", "", FuncOne(G6 / O6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="19" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(P6 = "" || H6 = "", "", FuncOne(H6 / P6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="20" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(T6 = "" || S6 = "", "", T6 - S6)]]></Attributes>
</O>
<Expand/>
</C>
<C c="21" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(AND(IF(O6 = 0, 0, (G6 / O6)) != 0, trim(G6) != "", trim(T6) != "", trim(S6) != ""), CONCATENATE(FuncOne((IF(P6 = 0, 0, (H6 / P6)) - (G6 / O6)) / (G6 / O6) * 100), "%"), "")]]></Attributes>
</O>
<Expand/>
</C>
<C c="22" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qjjygs"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="23" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="bjjygs"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="24" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(X6) = "" || trim(W6) = "", "", X6 - W6)]]></Attributes>
</O>
<Expand/>
</C>
<C c="25" r="5" s="6">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(W6) = "" || trim(X6) = "", "", CONCATENATE(FuncOne((X6 - W6) / W6 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="26" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="qfujiafei"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="27" r="5" s="6">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="bfujiafei"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[if($$$=0,"",$$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="0" r="6" cs="2" s="7">
<O>
<![CDATA[合计：]]></O>
<Expand/>
</C>
<C c="2" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(C6)) = 0, "", FuncOne(SUM(C6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="3" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(D6)) = 0, "", FuncOne(SUM(D6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="4" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(D7) = "" || trim(C7) = "", "", FuncOne(D7 - C7))]]></Attributes>
</O>
<Expand/>
</C>
<C c="5" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(C7) = "" || trim(D7) = "", "", CONCATENATE(FuncOne((D7 - C7) / C7 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="6" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(G6)) = 0, "", FuncOne(SUM(G6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="7" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(H6)) = 0, "", FuncOne(SUM(H6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="8" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(H7) = "" || trim(G7) = "", "", FuncOne(H7 - G7))]]></Attributes>
</O>
<Expand/>
</C>
<C c="9" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(G7) = "" || trim(H7) = "", "", CONCATENATE(FuncOne((H7 - G7) / G7 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="10" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(K6)) = 0, "", FuncOne(SUM(K6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="11" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(L6)) = 0, "", FuncOne(SUM(L6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="12" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(L7) = "" || trim(K7) = "", "", FuncOne(L7 - K7))]]></Attributes>
</O>
<Expand/>
</C>
<C c="13" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(K7) = "" || trim(L7) = "", "", CONCATENATE(FuncOne((L7 - K7) / K7 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="14" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(SUM(O6) = 0, "", SUM(O6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="15" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(SUM(P6) = 0, "", SUM(P6))]]></Attributes>
</O>
<Expand/>
</C>
<C c="16" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(P7) = "" || trim(O7) = "", "", P7 - O7)]]></Attributes>
</O>
<Expand/>
</C>
<C c="17" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(O7) = "" || trim(P7) = "", "", CONCATENATE(FuncOne((P7 - O7) / O7 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="18" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(O7) = "" || trim(G7) = "", "", FuncOne(G7 / O7))]]></Attributes>
</O>
<Expand/>
</C>
<C c="19" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(P7) = "" || trim(H7) = "", "", FuncOne(H7 / P7))]]></Attributes>
</O>
<Expand/>
</C>
<C c="20" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(T7) = "" || trim(S7) = "", "", T7 - S7)]]></Attributes>
</O>
<Expand/>
</C>
<C c="21" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(AND(IF(O7 = 0, 0, (G7 / O7)) != 0, G7 != 0, trim(S7) != "", trim(T7) != ""), CONCATENATE(FuncOne((IF(P7 = 0, 0, (H7 / P7)) - (G7 / O7)) / (G7 / O7) * 100), "%"), "")]]></Attributes>
</O>
<Expand/>
</C>
<C c="22" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(W6)) = 0, "", FuncOne(SUM(W6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="23" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(FuncOne(SUM(X6)) = 0, "", FuncOne(SUM(X6)))]]></Attributes>
</O>
<Expand/>
</C>
<C c="24" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=if(trim(X7) = "" || trim(W7) = "", "", X7 - W7)]]></Attributes>
</O>
<Expand/>
</C>
<C c="25" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=IF(trim(W7) = "" || trim(X7) = "", "", CONCATENATE(FuncOne((X7 - W7) / W7 * 100), "%"))]]></Attributes>
</O>
<Expand/>
</C>
<C c="26" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(AA6)]]></Attributes>
</O>
<Expand/>
</C>
<C c="27" r="6" s="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(AB6)]]></Attributes>
</O>
<Expand/>
</C>
<C c="0" r="7" cs="5">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[="打印日期：" + TODAY()]]></Attributes>
</O>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="5" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="6" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="7" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="8" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="9" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="10" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="11" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="12" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="13" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="14" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="15" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="16" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="17" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="18" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="19" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="20" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="21" r="7">
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="22" r="7" cs="4" s="8">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[="页次:第 " + $$page_number + " 页/共 " + $$totalPage_number + " 页"]]></Attributes>
</O>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="27" r="7" s="1">
<Expand/>
</C>
</CellElementList>
<ReportAttrSet>
<ReportSettings headerHeight="0" footerHeight="0">
<PaperSetting orientation="1">
<PaperSize width="30241036" height="115200000"/>
<Margin top="0" left="0" bottom="0" right="0"/>
</PaperSetting>
</ReportSettings>
<Header reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Header>
<Footer reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Footer>
</ReportAttrSet>
</Report>
<ReportParameterAttr>
<Attributes showWindow="false" delayPlaying="true" windowPosition="1" align="1"/>
<PWTitle>
<![CDATA[参数]]></PWTitle>
</ReportParameterAttr>
<StyleList>
<Style imageLayout="1">
<FRFont name="黑体" style="1" size="104"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="112"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style imageLayout="1">
<FRFont name="SimSun" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="4" imageLayout="1">
<FRFont name="SimSun" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="4" imageLayout="1">
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
</StyleList>
</WorkBook>
