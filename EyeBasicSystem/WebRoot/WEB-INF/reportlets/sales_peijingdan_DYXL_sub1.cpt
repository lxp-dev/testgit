<?xml version="1.0" encoding="UTF-8"?>
<WorkBook xmlVersion="20120529" releaseVersion="7.0.0">
<TableDataMap>
<TableData name="ds1" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="salesID"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[SELECT S_SE_SB_SalesRemark                                      AS '销售备注',
       ( CASE Isnull(S_SE_SB_PayCash, 0)
           WHEN 0 THEN ''
           ELSE '√'
         END )                                                  AS '现金结款',
       ( CASE Isnull(S_SE_SB_BankCard, 0)
           WHEN 0 THEN ''
           ELSE '√'
         END )                                                  AS '银行卡结款',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_BallGlassOS
	WHEN 'R' THEN S_SE_SB_BallGlassOD
	ELSE ''
	END)          AS '球镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_PostGlassOS
	WHEN 'R' THEN S_SE_SB_PostGlassOD
	ELSE ''
	END)          AS '柱镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_AxesOS
	WHEN 'R' THEN S_SE_SB_AxesOD
	ELSE ''
	END)                    AS '轴向',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_ArriseGlassOS1
	WHEN 'R' THEN S_SE_SB_ArriseGlassOD1
	ELSE ''
	END)    AS '棱镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_BasisOS1
	WHEN 'R' THEN S_SE_SB_BasisOD1
	ELSE ''
	END)              AS '基底',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_ADDOS
	WHEN 'R' THEN S_SE_SB_ADDOD
	ELSE ''
	END)        AS '下加光ADD',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN  (CASE S_SE_SB_RecipeType
                           WHEN '2' THEN S_SE_SB_InterDistanceOS
                           ELSE S_SE_SB_InterHighOS
                         END )
	WHEN 'R' THEN ( CASE S_SE_SB_RecipeType
                  WHEN '2' THEN S_SE_SB_InterDistanceOD
                  ELSE S_SE_SB_InterHighOD
                END )
	ELSE ''
	END)                       AS '瞳距',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN ( CASE S_SE_SB_RecipeType
                           WHEN '2' THEN S_SE_SB_CloseVAOS
                           WHEN '4' THEN S_SE_SB_CloseVAOS
                           ELSE S_SE_SB_FarVAOS
                         END )
	WHEN 'R' THEN ( CASE S_SE_SB_RecipeType
                  WHEN '2' THEN S_SE_SB_CloseVAOD
                  WHEN '4' THEN S_SE_SB_CloseVAOD
                  ELSE S_SE_SB_FarVAOD
                END )
	ELSE ''
	END)                                AS 'V矫',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_DiameterOS
	WHEN 'R' THEN S_SE_SB_DiameterOD
	ELSE ''
	END)             AS '直径',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_EyeCurvatureOS1
	WHEN 'R' THEN S_SE_SB_EyeCurvatureOD1
	ELSE ''
	END)  AS '基弧',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_PupilHeightOS
	WHEN 'R' THEN S_SE_SB_PupilHeightOD
	ELSE ''
	END)      AS '瞳高',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN Isnull(S_SE_SB_EyeCurvatureOS1, S_SE_SB_EyeCurvatureOS2)
	WHEN 'R' THEN Isnull(S_SE_SB_EyeCurvatureOD1, S_SE_SB_EyeCurvatureOD2)
	ELSE ''
	END) AS '曲率',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_FarVAOS
	WHEN 'R' THEN S_SE_SB_FarVAOD
	ELSE ''
	END)                 AS '远用VA',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_CloseVAOS
	WHEN 'R' THEN S_SE_SB_CloseVAOD
	ELSE ''
	END)               AS '近用VA',
       S_SE_SD_SalesItemID                                      AS '商品代码',
       ( CASE
           WHEN ( S_SE_SD_CommoditiesFlag = '4'
                   OR S_SE_SD_CommoditiesFlag = '5' )
                AND F_SP_PrintStealthCheck = '1' THEN ( S_SE_SD_SalesItemName + '：' + Isnull(S_SE_SD_Guaranteeperiod, '') )
           ELSE S_SE_SD_SalesItemName
         END )                                                  AS '商品名称',
       S_SE_SD_Sprice                                           AS '商品单价',
       S_SE_SD_Number                                           AS '数量',
       S_SE_SD_PriceSum                                         AS '原价合计',
       S_SE_SD_SalesValue                                       AS '应收金额',
S_SE_SD_GlassFlag
FROM   F_SystemParameter, S_SE_SalesBasic
       LEFT JOIN S_OP_Inspection
         ON S_SE_SB_InspectionID = S_OP_IP_ID
            AND S_SE_SB_OptometryID = S_OP_IP_OptometryID
       INNER JOIN S_SE_SalesDetail
         ON S_SE_SD_SalesID = S_SE_SB_SalesID
            AND S_SE_SD_CommoditiesFlag IN ( '3', '4', '5', '6',
                                             '7', '8' )
WHERE  S_SE_SB_SalesID = '${salesID}'
       AND S_SE_SB_ValueFlag = '1'


union all 

SELECT S_SE_SB_SalesRemark                                      AS '销售备注',
       ( CASE Isnull(S_SE_SB_PayCash, 0)
           WHEN 0 THEN ''
           ELSE '√'
         END )                                                  AS '现金结款',
       ( CASE Isnull(S_SE_SB_BankCard, 0)
           WHEN 0 THEN ''
           ELSE '√'
         END )                                                  AS '银行卡结款',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_BallGlassOS
	WHEN 'R' THEN S_SE_SB_BallGlassOD
	ELSE ''
	END)          AS '球镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_PostGlassOS
	WHEN 'R' THEN S_SE_SB_PostGlassOD
	ELSE ''
	END)          AS '柱镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_AxesOS
	WHEN 'R' THEN S_SE_SB_AxesOD
	ELSE ''
	END)                    AS '轴向',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_ArriseGlassOS1
	WHEN 'R' THEN S_SE_SB_ArriseGlassOD1
	ELSE ''
	END)    AS '棱镜',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_BasisOS1
	WHEN 'R' THEN S_SE_SB_BasisOD1
	ELSE ''
	END)              AS '基底',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_ADDOS
	WHEN 'R' THEN S_SE_SB_ADDOD
	ELSE ''
	END)        AS '下加光ADD',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN  (CASE S_SE_SB_RecipeType
                           WHEN '2' THEN S_SE_SB_InterDistanceOS
                           ELSE S_SE_SB_InterHighOS
                         END )
	WHEN 'R' THEN ( CASE S_SE_SB_RecipeType
                  WHEN '2' THEN S_SE_SB_InterDistanceOD
                  ELSE S_SE_SB_InterHighOD
                END )
	ELSE ''
	END)                       AS '瞳距',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN ( CASE S_SE_SB_RecipeType
                           WHEN '2' THEN S_SE_SB_CloseVAOS
                           WHEN '4' THEN S_SE_SB_CloseVAOS
                           ELSE S_SE_SB_FarVAOS
                         END )
	WHEN 'R' THEN ( CASE S_SE_SB_RecipeType
                  WHEN '2' THEN S_SE_SB_CloseVAOD
                  WHEN '4' THEN S_SE_SB_CloseVAOD
                  ELSE S_SE_SB_FarVAOD
                END )
	ELSE ''
	END)                                AS 'V矫',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_DiameterOS
	WHEN 'R' THEN S_SE_SB_DiameterOD
	ELSE ''
	END)             AS '直径',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_EyeCurvatureOS1
	WHEN 'R' THEN S_SE_SB_EyeCurvatureOD1
	ELSE ''
	END)  AS '基弧',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_PupilHeightOS
	WHEN 'R' THEN S_SE_SB_PupilHeightOD
	ELSE ''
	END)      AS '瞳高',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN Isnull(S_SE_SB_EyeCurvatureOS1, S_SE_SB_EyeCurvatureOS2)
	WHEN 'R' THEN Isnull(S_SE_SB_EyeCurvatureOD1, S_SE_SB_EyeCurvatureOD2)
	ELSE ''
	END) AS '曲率',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_FarVAOS
	WHEN 'R' THEN S_SE_SB_FarVAOD
	ELSE ''
	END)                 AS '远用VA',
(CASE ISNULL(S_SE_SD_GlassFlag, '') 
	WHEN 'L' THEN S_SE_SB_CloseVAOS
	WHEN 'R' THEN S_SE_SB_CloseVAOD
	ELSE ''
	END)               AS '近用VA',
       S_SE_SD_SalesItemID                                      AS '商品代码',
       ( CASE
           WHEN ( S_SE_SD_CommoditiesFlag = '4'
                   OR S_SE_SD_CommoditiesFlag = '5' )
                AND F_SP_PrintStealthCheck = '1' THEN ( S_SE_SD_SalesItemName + '：' + Isnull(S_SE_SD_Guaranteeperiod, '') )
           ELSE S_SE_SD_SalesItemName
         END )                                                  AS '商品名称',
       S_SE_SD_Sprice                                           AS '商品单价',
       S_SE_SD_Number                                           AS '数量',
       S_SE_SD_PriceSum                                         AS '原价合计',
       S_SE_SD_SalesValue                                       AS '应收金额',
S_SE_SD_GlassFlag
FROM   F_SystemParameter, S_SE_SalesBasic_Finished
       LEFT JOIN S_OP_Inspection
         ON S_SE_SB_InspectionID = S_OP_IP_ID
            AND S_SE_SB_OptometryID = S_OP_IP_OptometryID
       INNER JOIN S_SE_SalesDetail_Finished
         ON S_SE_SD_SalesID = S_SE_SB_SalesID
            AND S_SE_SD_CommoditiesFlag IN ( '3', '4', '5', '6',
                                             '7', '8' )
WHERE  S_SE_SB_SalesID = '${salesID}'
       AND S_SE_SB_ValueFlag = '1'
ORDER  BY S_SE_SD_GlassFlag DESC ]]></Query>
</TableData>
</TableDataMap>
<Report class="com.fr.report.WorkSheet" name="sheet1">
<ReportPageAttr>
<HR/>
<FR/>
<HC/>
<FC/>
</ReportPageAttr>
<RowHeight defaultValue="723900">
<![CDATA[495300,723900,723900,723900,723900,723900,723900,723900,723900,723900,723900]]></RowHeight>
<ColumnWidth defaultValue="2743200">
<![CDATA[2019300,1866900,1752600,1752600,1866900,2057400,5867400,1905000,2743200,2743200,2743200]]></ColumnWidth>
<CellElementList>
<C c="0" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="球镜"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper">
<Attr divideMode="1"/>
</RG>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="1" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="柱镜"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="2" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="轴向"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="3" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="曲率1"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="4" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="瞳距"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="5" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="远用VA"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="6" r="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="商品名称"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper">
<Attr divideMode="1"/>
</RG>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="7" r="0" s="0">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="应收金额"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($wFlag==1, $$$, IF($wFlag==-1, ($$$*-1), $$$))]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
</CellElementList>
<ReportAttrSet>
<ReportSettings headerHeight="0" footerHeight="0">
<PaperSetting/>
</ReportSettings>
<Header reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Header>
<Footer reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Footer>
</ReportAttrSet>
</Report>
<StyleList>
<Style imageLayout="1">
<Format class="com.fr.base.CoreDecimalFormat">
<![CDATA[###0.00]]></Format>
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
</StyleList>
</WorkBook>
