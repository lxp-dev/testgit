<?xml version="1.0" encoding="UTF-8"?>
<WorkBook xmlVersion="20120529" releaseVersion="7.0.0">
<TableDataMap>
<TableData name="ds1" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="queryPersonID"/>
<O>
<![CDATA[2238]]></O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="bgndate"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="enddate"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[
select departmentID into #salesDepartments from sales_createShopCodeTab('${departmentid}')

if ('${bgndate}'<convert(varchar(10),getdate(),120))
begin


if ('${enddate}'<convert(varchar(10),getdate(),120))
begin

select ('${bgndate}'+'--'+'${enddate}') as queryDate,'' as departmentName,displayName as displayName, 
	sum(isnull(ygksNum,0)) as ygksNum,
	sum(isnull(ygmsNum,0)) as ygmsNum,
	sum(isnull(ygxrNum,0)) as ygxrNum,
	sum(isnull(ygfyNum,0)) as ygfyNum,
	sum(isnull(ygxkNum,0)) as ygxkNum,
	sum(isnull(ygzsNum,0)) as ygzsNum,
	sum(isnull(ygzxNum,0)) as ygzxNum,
    sum(isnull(dcnum,0)) as dcnum,
	sum(isnull(pNum,0)) as pNum,
	sum(isnull(pjdNum,0)) as pjdNum,
	sum(isnull(dycfNum,0)) as dycfNum,
    sum(isnull(gSum,0)) as gSum,
	sum(isnull(fSum,0)) as fSum,
	sum(isnull(hSum,0)) as hSum,
	sum(isnull(lSum,0)) as lSum,
	sum(isnull(sSum,0)) as sSum,
	sum(isnull(tSum,0)) as tSum,
	sum(isnull(cNum,0)) as cNum,
	sum(isnull(fmoneySum,0)) as fmoneySum,
	sum(isnull(xyfsum,0)) as xyfsum,
	personid  
  from (

select R_O_OS_personName as displayName,'' as departmentName, 
	sum(R_O_OS_ygksNum) as ygksNum,
	sum(R_O_OS_ygmsNum) as ygmsNum,
    sum(R_O_OS_ygxrNum) as ygxrNum,
    sum(R_O_OS_ygfyNum) as ygfyNum,
	sum(R_O_OS_ygksNum) as ygxkNum,
    sum(R_O_OS_ygzsNum) as ygzsNum,
    sum(R_O_OS_ygzxNum) as ygzxNum,
    sum(R_O_OS_dcNum) as dcnum,
	sum(R_O_OS_pNum) as pNum,
	sum(R_O_OS_pjdNum) as pjdNum,
	sum(R_O_OS_dycfNum) as dycfNum,
	sum(R_O_OS_gSum) as gSum,
	sum(R_O_OS_fSum) as fSum,
	sum(R_O_OS_hSum) as hSum,
	sum(R_O_OS_lSum) as lSum,
	sum(R_O_OS_sSum) as sSum,
	sum(R_O_OS_tSum) as tSum,
	0 as cNum,
	0 as fmoneySum,
	sum(R_O_OS_xyfsum) as xyfsum,
	R_O_OS_personID AS personid
  from R_optometryOnlyStore
  where R_O_OS_Date>='${bgndate}' and R_O_OS_Date<='${enddate}'
        AND ((ISNULL('${departmentid}', '') <> '') AND (R_O_OS_DepartmentId in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))

  group by R_O_OS_personName,R_O_OS_personID
union all
select  personName as displayName,'' as departmentName, 
		0 as ygksNum,
		0 as ygmsNum,
		0 as ygxrNum,
		0 as ygfyNum,
		0 as ygxkNum,
		0 as ygzsNum,
		0 as ygzxNum,
		0 as dcnum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		count(S_CR_RD_CheckPerson) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		S_CR_RD_CheckPerson as personid
	from S_CR_RegisteredDetails 
	inner join SYS_PersonInfo on ID = S_CR_RD_CheckPerson
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> ''
	and F_RC_FeeType = '1' 
	group by S_CR_RD_CheckPerson,personName

union all
select  personName as displayName,'' as departmentName, 
		0 as ygksNum,
		0 as ygmsNum,
		0 as ygxrNum,
		0 as ygfyNum,
		0 as ygxkNum,
		0 as ygzsNum,
		0 as ygzxNum,
		0 as dcnum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		-count(S_CR_RD_CheckPerson) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		S_CR_RD_CheckPerson as personid
	from S_CR_RegisteredDetails 
	inner join SYS_PersonInfo on ID = S_CR_RD_CheckPerson
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> ''
	and F_RC_FeeType = '2' 
	group by S_CR_RD_CheckPerson,personName
)temp
  where isnull(ygksNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(pjdNum,0) <>0 or isnull(dycfNum,0) <> 0 or isnull(gSum,0) <>0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) <>0 
group by displayName,personid
end
else
begin

      SELECT S_OP_OY_PersonID
      INTO   #Optometry1
      FROM   S_OP_Optometry
      WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
        AND  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND  ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND  ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))

      GROUP  BY S_OP_OY_PersonID
      ORDER  BY S_OP_OY_PersonID

      SELECT S_OP_OY_PersonID
      INTO   #S_OP_Inspection1
      FROM   S_OP_Inspection
             INNER JOIN S_OP_Optometry
               ON S_OP_OY_OptometryID = S_OP_IP_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
      ORDER  BY S_OP_OY_PersonID

      SELECT S_OP_OY_PersonID
      INTO   #S_se_SalesBasic1
      FROM   S_OP_Optometry
             INNER JOIN uview_SalesBasic
               ON S_SE_SB_OptometryID = S_OP_OY_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_SE_SB_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))

      GROUP  BY S_OP_OY_PersonID
      ORDER  BY S_OP_OY_PersonID
	  
	  SELECT S_CR_RD_CheckPerson
      INTO   #Registered1
      FROM   S_CR_RegisteredDetails
      WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
			 AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      ORDER  BY S_CR_RD_CheckPerson

select ('${bgndate}'+'--'+'${enddate}') as queryDate,
    '' as departmentName,displayName as displayName, 
	isnull(ygksNum,0) as ygksNum,
	isnull(ygmsNum,0) as ygmsNum,
	isnull(ygxrNum,0) as ygxrNum,
	isnull(ygfyNum,0) as ygfyNum,
	isnull(ygxkNum,0) as ygxkNum,
	isnull(ygzsNum,0) as ygzsNum,
	isnull(ygzxNum,0) as ygzxNum,
    isnull(dcnum,0) as dcnum,
	isnull(pNum,0) as pNum,
	isnull(pjdNum,0) as pjdNum,
	isnull(dycfNum,0) as dycfNum,
    isnull(gSum,0) as gSum,
	isnull(fSum,0) as fSum,
	isnull(hSum,0) as hSum,
	isnull(lSum,0) as lSum,
	isnull(sSum,0) as sSum,
	isnull(tSum,0) as tSum,
	isnull(cNum,0) as cNum,
	isnull(fmoneySum,0) as fmoneySum,
	isnull(xyfsum,0) as xyfsum, 
	personid 

 from (

select '' as departmentName,displayName as displayName, 
	sum(ygksNum) as ygksNum,
	sum(ygmsNum) as ygmsNum,
	sum(ygxrNum) as ygxrNum,
	sum(ygfyNum) as ygfyNum,
	sum(ygxkNum) as ygxkNum,
	sum(ygzsNum) as ygzsNum,
	sum(ygzxNum) as ygzxNum,
    sum(dcnum) as dcnum,
	sum(pNum) as pNum,
	sum(pjdNum) as pjdNum,
	sum(dycfNum) as dycfNum,
    sum(gSum) as gSum,
	sum(fSum) as fSum,
	sum(hSum) as hSum,
	sum(lSum) as lSum,
	sum(sSum) as sSum,
	sum(tSum) as tSum,
	sum(cNum) as cNum,
	sum(fmoneySum) as fmoneySum,
	sum(xyfsum) as xyfsum ,
	personid
	 from (

select R_O_OS_personName as displayName,'' as departmentName, 
	sum(R_O_OS_ygksNum) as ygksNum,
	sum(R_O_OS_ygmsNum) as ygmsNum,
    sum(R_O_OS_ygxrNum) as ygxrNum,
    sum(R_O_OS_ygfyNum) as ygfyNum,
	sum(R_O_OS_ygxkNum) as ygxkNum,
    sum(R_O_OS_ygzsNum) as ygzsNum,
    sum(R_O_OS_ygzxNum) as ygzxNum,
    sum(R_O_OS_dcNum) as dcnum,
	sum(R_O_OS_pNum) as pNum,
	sum(R_O_OS_pjdNum) as pjdNum,
	sum(R_O_OS_dycfNum) as dycfNum,
	sum(R_O_OS_gSum) as gSum,
	sum(R_O_OS_fSum) as fSum,
	sum(R_O_OS_hSum) as hSum,
	sum(R_O_OS_lSum) as lSum,
	sum(R_O_OS_sSum) as sSum,
	sum(R_O_OS_tSum) as tSum,
	0 as cNum,
	0 as fmoneySum,
	sum(R_O_OS_xyfsum) as xyfsum,
	R_O_OS_personID AS personid
  from R_optometryOnlyStore
  where R_O_OS_Date>='${bgndate}' and R_O_OS_Date<=convert(char(10), dateadd(day,-1,'${enddate}'),120)
        AND ((ISNULL('${departmentid}', '') <> '') AND (R_O_OS_DepartmentId in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
  
 group by R_O_OS_personName,R_O_OS_personID

union all
select  personName as displayName,'' as departmentName, 
		0 as ygksNum,
		0 as ygmsNum,
		0 as ygxrNum,
		0 as ygfyNum,
		0 as ygxkNum,
		0 as ygzsNum,
		0 as ygzxNum,
		0 as dcnum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		count(S_CR_RD_CheckPerson) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		S_CR_RD_CheckPerson as personid
	from S_CR_RegisteredDetails 
	inner join SYS_PersonInfo on ID = S_CR_RD_CheckPerson
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> '' 
	and F_RC_FeeType = '1'
	group by S_CR_RD_CheckPerson,personName

union all
select  personName as displayName,'' as departmentName, 
		0 as ygksNum,
		0 as ygmsNum,
		0 as ygxrNum,
		0 as ygfyNum,
		0 as ygxkNum,
		0 as ygzsNum,
		0 as ygzxNum,
		0 as dcnum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		-count(S_CR_RD_CheckPerson) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		S_CR_RD_CheckPerson as personid
	from S_CR_RegisteredDetails 
	inner join SYS_PersonInfo on ID = S_CR_RD_CheckPerson
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> '' 
	and F_RC_FeeType = '2'
	group by S_CR_RD_CheckPerson,personName

union all
----------------------------------------------
     SELECT PersonName as displayName,
			'' as departmentName,
            ygNum as ygksNum,
			ygmsNum as ygmsNum,
			ygxrNum as ygxrNum,
			ygfyNum as ygfyNum,
			ygxkNum as ygxkNum,
			ygzsNum as ygzsNum,
			ygzxNum as ygzxNum,
            dcnum as dcnum,
			pNum as pNum,
			sNum as pjdNum,
			prNum as dycfNum,
			gSum as gSum,
			fSum as fSum,
			hSum as hSum,
			lSum as lSum,
			sSum as sSum,
			tSum as tSum,
			0 as cNum,
			0 as fmoneySum,
			xyfsum as xyfsum,
			p.personid
      FROM   (SELECT p.id AS personid,
                     p.PersonName as PersonName
              FROM   sys_personinfo p
                     INNER JOIN (SELECT *
                                 FROM   #Optometry1
                                 UNION
                                 SELECT *
                                 FROM   #S_OP_Inspection1
                                 UNION
                                 SELECT *
                                 FROM   #S_se_SalesBasic1
								 UNION
                                 SELECT *
                                 FROM   #Registered1)person
                       ON person.S_OP_OY_PersonID = p.ID)p
			 LEFT JOIN (select S_OP_R_RefractiverID,isnull(count(S_OP_R_CustomerID),0) as ygNum --验光数
						from dbo.S_OP_Refractive
						where convert(varchar(10),S_OP_R_Inspection_date,23) >= CONVERT(VARCHAR(10),getdate(), 23)
						and	  convert(varchar(10),S_OP_R_Inspection_date,23) <= CONVERT(VARCHAR(10),getdate(), 23)
       AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by S_OP_R_RefractiverID)yg
				ON p.PersonID = yg.S_OP_R_RefractiverID
	LEFT JOIN (select sopr2.S_OP_R_RefractiverID,isnull(count(sopr2.S_OP_R_ID),0) as ygmsNum --散瞳数
						from dbo.S_OP_Refractive sopr2
						where convert(varchar(10),sopr2.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr2.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr2.S_OP_R_DiffusePupil='2'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr2.S_OP_R_RefractiverID)yg2
				ON p.PersonID = yg2.S_OP_R_RefractiverID


			LEFT JOIN (select sopr1.S_OP_R_RefractiverID,isnull(count(sopr1.S_OP_R_ID),0) as ygxrNum --显然验光数
						from dbo.S_OP_Refractive sopr1
						where convert(varchar(10),sopr1.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr1.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr1.S_OP_R_DiffusePupil='1'
        AND ((ISNULL('${departmentid}', '') <> '') AND (sopr1.S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (sopr1.S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr1.S_OP_R_RefractiverID)yg1
				ON p.PersonID = yg1.S_OP_R_RefractiverID

			LEFT JOIN (select sopr10.S_OP_R_RefractiverID,isnull(count(sopr10.S_OP_R_ID),0) as ygfyNum  --复检
						from dbo.S_OP_Refractive sopr10
						where convert(varchar(10),sopr10.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr10.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr10.S_OP_R_DiffusePupil='10'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr10.S_OP_R_RefractiverID)yg10
				ON p.PersonID = yg10.S_OP_R_RefractiverID


			LEFT JOIN (select sopr3.S_OP_R_RefractiverID,isnull(count(sopr3.S_OP_R_ID),0) as ygxkNum --显加快
						from dbo.S_OP_Refractive sopr3
						where convert(varchar(10),sopr3.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr3.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr3.S_OP_R_DiffusePupil='3'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr3.S_OP_R_RefractiverID)yg3
				ON p.PersonID = yg3.S_OP_R_RefractiverID

			LEFT JOIN (select sopr4.S_OP_R_RefractiverID,isnull(count(sopr4.S_OP_R_ID),0) as ygzsNum --左散右显
						from dbo.S_OP_Refractive sopr4
						where convert(varchar(10),sopr4.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr4.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr4.S_OP_R_DiffusePupil='4'
	    AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr4.S_OP_R_RefractiverID)yg4
				ON p.PersonID = yg4.S_OP_R_RefractiverID

			LEFT JOIN (select sopr5.S_OP_R_RefractiverID,isnull(count(sopr5.S_OP_R_ID),0) as ygzxNum   --左显右散
						from dbo.S_OP_Refractive sopr5
						where convert(varchar(10),sopr5.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr5.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr5.S_OP_R_DiffusePupil='5'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr5.S_OP_R_RefractiverID)yg5
				ON p.PersonID = yg5.S_OP_R_RefractiverID
	


             LEFT JOIN (SELECT i1.S_OP_OY_PersonID,
                               SUM(op.pNum) AS pNum
                        FROM   S_OP_Optometry i1
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS pNum --处方单数
                                                 ,
                                                 S_OP_IP_OptometryID
                                          FROM   S_OP_Inspection
                                          GROUP  BY S_OP_IP_OptometryID) op
                                 ON i1.S_OP_OY_OptometryID = op.S_OP_IP_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
        AND S_OP_OY_Flag = '1'            
			GROUP  BY i1.S_OP_OY_PersonID)pr
               ON p.PersonID = pr.S_OP_OY_PersonID
             LEFT JOIN (SELECT i2.S_OP_OY_PersonID
                               --,isnull(sum(sp.sNum),0) as sNum
                               --,isnull(sum(tsp.tsNum),0) as tsNum
                               ,
                               Isnull(SUM(sp.sNum), 0) + Isnull(SUM(tsp.tsNum), 0) AS sNum --配镜单数
                        FROM   S_OP_Optometry i2
                               LEFT JOIN (SELECT COUNT(S_SE_SB_SalesID) AS sNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) sp
                                 ON i2.S_OP_OY_OptometryID = sp.S_SE_SB_OptometryID
                               LEFT JOIN (SELECT COUNT(s_se_sb_salesid) AS tsNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) tsp
                                 ON i2.S_OP_OY_OptometryID = tsp.S_SE_SB_OptometryID
                        GROUP  BY i2.S_OP_OY_PersonID)s
               ON p.PersonID = s.S_OP_OY_PersonID
             LEFT JOIN (SELECT i3.S_OP_OY_PersonID,
                               SUM(opp.prNum) AS prNum --打印处方数
                        FROM   S_OP_Optometry i3
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS prNum,
                                                 s_op_ip_OptometryID
                                          FROM   S_OP_Inspection
                                          WHERE  s_op_ip_PrintFlag = '1'
                                          GROUP  BY s_op_ip_OptometryID)opp
                                 ON i3.s_op_oy_OptometryID = opp.s_op_ip_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                        GROUP  BY i3.s_op_oy_PersonID)pp
               ON p.PersonID = pp.s_op_oy_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS gSum --镜片金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.s_op_oy_PersonID)g
               ON p.PersonID = g.S_OP_OY_PersonID
             LEFT JOIN (SELECT i5.S_OP_OY_PersonID
                               --,isnull(sum(gf.fSum),0.0) as fSum
                               --,isnull(sum(tgf.tfsum),0.0) as tfsum
                               ,Isnull(SUM(tgf.fSum), 0.0) AS fSum --镜架金额
                        FROM   S_OP_Optometry i5
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS fSum,
                                                 s_se_Sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_Sb_OptometryID
										UNION ALL 
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tfSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
													B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgf
                                 ON i5.s_op_oy_OptometryID = tgf.s_se_sb_OptometryID
                        GROUP  BY i5.s_op_oy_PersonID)f
               ON p.PersonID = f.S_OP_OY_PersonID
             LEFT JOIN (SELECT i6.S_OP_OY_PersonID
                               ,Isnull(SUM(tgh.hSum), 0.00) AS hSum --隐形金额
                        FROM   S_OP_Optometry i6
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS hSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS thSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgh
                                 ON i6.s_op_oy_OptometryID = tgh.s_se_sb_OptometryID
                        GROUP  BY i6.S_OP_OY_PersonID)h
               ON p.PersonID = h.S_OP_OY_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS lSum --老花镜金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_PersonID)glhj
               ON p.PersonID = glhj.S_OP_OY_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS sSum --视光类金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_PersonID)gsgl
               ON p.PersonID = gsgl.S_OP_OY_PersonID
             LEFT JOIN (SELECT i7.s_op_oy_PersonID
                               --,isnull(sum(total.tSum),0.00) as tSum
                               --,isnull(sum(ttotal.ttSum),0.00) as ttSum
                               ,SUM(Isnull(ttotal.tSum, 0.00)) AS tSum --总金额
                        FROM   S_OP_Optometry i7
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS tSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
									UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS ttSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) ttotal
                                 ON i7.s_op_oy_OptometryID = ttotal.s_se_sb_OptometryID
                        GROUP  BY i7.s_op_oy_PersonID)t
               ON p.PersonID = t.s_op_oy_PersonID
             LEFT JOIN (SELECT COUNT(s_op_oy_OptometryID) AS cNum --检查数
                               ,s_op_oy_PersonID
                        FROM   S_OP_Optometry
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (s_op_oy_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                        GROUP  BY s_op_oy_PersonID)ch
               ON p.PersonID = ch.s_op_oy_PersonID
             LEFT JOIN (SELECT S_CR_RD_CheckPerson,
                                                 SUM(S_CR_RD_Money)                        AS fmoneySum
                                          FROM   S_CR_RegisteredDetails
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_CheckPerson)c
               ON p.PersonID = c.S_CR_RD_CheckPerson
             
             LEFT JOIN (SELECT S_CR_RD_Register                 AS personid,
                               Isnull(SUM(S_CR_RD_Money), 0.00) AS xyfsum --西药费
                        FROM   S_CR_RegisteredDetails
                               INNER JOIN F_RegisteredCategory
                                 ON S_CR_RD_RegisteredID = F_RC_ID
                                    --inner join i_registered_print_details
                                    --on i_registered.registeredtype=i_registered_print_details.registeredid
                                    --where i_registered_print_details.flag='3'
                                    AND S_CR_RD_flag = '1'
                                    AND F_RC_RegisteredType = '2'
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
            AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_Register='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                        GROUP  BY S_CR_RD_Register)xyf
               ON p.PersonID = xyf.personid 

			  left join (SELECT S_OP_OY_PersonID                           AS personid,
								count(*) as dcnum   --双眼视功能检查数
			   FROM   S_OP_Optometry
					  INNER JOIN SYS_PersonInfo
						ON S_OP_OY_PersonID = SYS_PersonInfo.ID
					  INNER JOIN B_Departments
						ON S_OP_OY_ShopCode = B_DP_DepartmentID
					  INNER JOIN S_ME_CustomerInfo
						ON S_ME_CI_CustomerID = S_OP_OY_CustomerID
						   AND S_OP_OY_OptometryID IN(SELECT S_OP_DE_OptometryID
													  FROM   S_OP_DoubleEyeFunction where isnull(S_OP_DE_Account,'')='')
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						   AND S_OP_OY_Flag = '1'
			   group by S_OP_OY_PersonID)doublecheck on p.PersonID = doublecheck.personid

)temp
  group by  displayName,personid

)temp
  where isnull(ygksNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(pjdNum,0) <>0 or isnull(dycfNum,0) <> 0 or isnull(gSum,0) <>0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) >0 or isnull(dcnum,0)<>0

----------------------------------------------
        DROP TABLE #Optometry1
        DROP TABLE #S_OP_Inspection1
        DROP TABLE #S_se_SalesBasic1
		DROP TABLE #Registered1

end

end
else
begin

-------------------------------------------------

      SELECT S_OP_OY_PersonID
      INTO   #Optometry
      FROM   S_OP_Optometry
      WHERE  ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
      GROUP  BY S_OP_OY_PersonID
      ORDER  BY S_OP_OY_PersonID

      SELECT S_OP_OY_PersonID
      INTO   #S_OP_Inspection
      FROM   S_OP_Inspection
             INNER JOIN S_OP_Optometry
               ON S_OP_OY_OptometryID = S_OP_IP_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
      ORDER  BY S_OP_OY_PersonID

      SELECT S_OP_OY_PersonID
      INTO   #uview_SalesBasic
      FROM   S_OP_Optometry
             INNER JOIN uview_SalesBasic
               ON S_SE_SB_OptometryID = S_OP_OY_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_SE_SB_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
      GROUP  BY S_OP_OY_PersonID
      ORDER  BY S_OP_OY_PersonID

	  SELECT S_CR_RD_CheckPerson
      INTO   #Registered
      FROM   S_CR_RegisteredDetails
      WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
			 AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      ORDER  BY S_CR_RD_CheckPerson

      SELECT ('${bgndate}'+'--'+'${enddate}') as queryDate,
             PersonName as displayName,'' as departmentName,
             isnull(ygNum,0) as ygksNum,
	isnull(ygmsNum,0) as ygmsNum,
	isnull(ygxrNum,0) as ygxrNum,
	isnull(ygfyNum,0) as ygfyNum,
	isnull(ygxkNum,0) as ygxkNum,
	isnull(ygzsNum,0) as ygzsNum,
	isnull(ygzxNum,0) as ygzxNum,
    isnull(dcnum,0) as dcnum,
	isnull(pNum,0) as pNum,isnull(sNum,0) as pjdNum,isnull(prNum,0) as dycfNum,isnull(gSum,0) as gSum
             ,isnull(fSum,0) as fSum,isnull(hSum,0) as hSum,isnull(lSum,0) as lSum,isnull(sSum,0) as sSum,isnull(tSum,0) as tSum,isnull(cNum,0) as cNum,isnull(fmoneySum,0) as fmoneySum,isnull(xyfsum,0) as xyfsum, 
	p.personid
      FROM   (SELECT p.id AS personid,
                     p.PersonName as PersonName
              FROM   sys_personinfo p
                     INNER JOIN (SELECT *
                                 FROM   #Optometry
                                 UNION
                                 SELECT *
                                 FROM   #S_OP_Inspection
                                 UNION
                                 SELECT *
                                 FROM   #uview_SalesBasic
								 UNION
                                 SELECT *
                                 FROM   #Registered)person
                       ON person.S_OP_OY_PersonID = p.ID)p
			 LEFT JOIN (select S_OP_R_RefractiverID,isnull(count(S_OP_R_CustomerID),0) as ygNum --验光数
						from dbo.S_OP_Refractive
						where convert(varchar(10),S_OP_R_Inspection_date,23) >= CONVERT(VARCHAR(10),getdate(), 23)
						and	  convert(varchar(10),S_OP_R_Inspection_date,23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by S_OP_R_RefractiverID)yg
				ON p.PersonID = yg.S_OP_R_RefractiverID
	LEFT JOIN (select sopr2.S_OP_R_RefractiverID,isnull(count(sopr2.S_OP_R_ID),0) as ygmsNum --散瞳数
						from dbo.S_OP_Refractive sopr2
						where convert(varchar(10),sopr2.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr2.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr2.S_OP_R_DiffusePupil='2'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr2.S_OP_R_RefractiverID)yg2
				ON p.PersonID = yg2.S_OP_R_RefractiverID


			LEFT JOIN (select sopr1.S_OP_R_RefractiverID,isnull(count(sopr1.S_OP_R_ID),0) as ygxrNum --显然验光数
						from dbo.S_OP_Refractive sopr1
						where convert(varchar(10),sopr1.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr1.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr1.S_OP_R_DiffusePupil='1'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr1.S_OP_R_RefractiverID)yg1
				ON p.PersonID = yg1.S_OP_R_RefractiverID

			LEFT JOIN (select sopr10.S_OP_R_RefractiverID,isnull(count(sopr10.S_OP_R_ID),0) as ygfyNum  --复检
						from dbo.S_OP_Refractive sopr10
						where convert(varchar(10),sopr10.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr10.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr10.S_OP_R_DiffusePupil='10'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr10.S_OP_R_RefractiverID)yg10
				ON p.PersonID = yg10.S_OP_R_RefractiverID


			LEFT JOIN (select sopr3.S_OP_R_RefractiverID,isnull(count(sopr3.S_OP_R_ID),0) as ygxkNum --显加快
						from dbo.S_OP_Refractive sopr3
						where convert(varchar(10),sopr3.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr3.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr3.S_OP_R_DiffusePupil='3'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr3.S_OP_R_RefractiverID)yg3
				ON p.PersonID = yg3.S_OP_R_RefractiverID

			LEFT JOIN (select sopr4.S_OP_R_RefractiverID,isnull(count(sopr4.S_OP_R_ID),0) as ygzsNum --左散右显
						from dbo.S_OP_Refractive sopr4
						where convert(varchar(10),sopr4.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr4.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr4.S_OP_R_DiffusePupil='4'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr4.S_OP_R_RefractiverID)yg4
				ON p.PersonID = yg4.S_OP_R_RefractiverID

			LEFT JOIN (select sopr5.S_OP_R_RefractiverID,isnull(count(sopr5.S_OP_R_ID),0) as ygzxNum   --左显右散
						from dbo.S_OP_Refractive sopr5
						where convert(varchar(10),sopr5.S_OP_R_Inspection_date,23) >= '${bgndate}'
						and	  convert(varchar(10),sopr5.S_OP_R_Inspection_date,23) <= '${enddate}'
						and  sopr5.S_OP_R_DiffusePupil='5'
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_R_RefractiverID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						group by sopr5.S_OP_R_RefractiverID)yg5
				ON p.PersonID = yg5.S_OP_R_RefractiverID


             LEFT JOIN (SELECT i1.S_OP_OY_PersonID,
                               SUM(op.pNum) AS pNum
                        FROM   S_OP_Optometry i1
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS pNum --处方单数
                                                 ,
                                                 S_OP_IP_OptometryID
                                          FROM   S_OP_Inspection
                                          GROUP  BY S_OP_IP_OptometryID) op
                                 ON i1.S_OP_OY_OptometryID = op.S_OP_IP_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
        AND S_OP_OY_Flag = '1'              
			GROUP  BY i1.S_OP_OY_PersonID)pr
               ON p.PersonID = pr.S_OP_OY_PersonID
             LEFT JOIN (SELECT i2.S_OP_OY_PersonID
                               --,isnull(sum(sp.sNum),0) as sNum
                               --,isnull(sum(tsp.tsNum),0) as tsNum
                               ,
                               Isnull(SUM(sp.sNum), 0) + Isnull(SUM(tsp.tsNum), 0) AS sNum --配镜单数
                        FROM   S_OP_Optometry i2
                               LEFT JOIN (SELECT COUNT(S_SE_SB_SalesID) AS sNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) sp
                                 ON i2.S_OP_OY_OptometryID = sp.S_SE_SB_OptometryID
                               LEFT JOIN (SELECT COUNT(s_se_sb_salesid) AS tsNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) tsp
                                 ON i2.S_OP_OY_OptometryID = tsp.S_SE_SB_OptometryID
                        GROUP  BY i2.S_OP_OY_PersonID)s
               ON p.PersonID = s.S_OP_OY_PersonID
             LEFT JOIN (SELECT i3.S_OP_OY_PersonID,
                               SUM(opp.prNum) AS prNum --打印处方数
                        FROM   S_OP_Optometry i3
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS prNum,
                                                 s_op_ip_OptometryID
                                          FROM   S_OP_Inspection
                                          WHERE  s_op_ip_PrintFlag = '1'
                                          GROUP  BY s_op_ip_OptometryID)opp
                                 ON i3.s_op_oy_OptometryID = opp.s_op_ip_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                        GROUP  BY i3.s_op_oy_PersonID)pp
               ON p.PersonID = pp.s_op_oy_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS gSum --镜片金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.s_op_oy_PersonID)g
               ON p.PersonID = g.S_OP_OY_PersonID
             LEFT JOIN (SELECT i5.S_OP_OY_PersonID
                               --,isnull(sum(gf.fSum),0.0) as fSum
                               --,isnull(sum(tgf.tfsum),0.0) as tfsum
                               ,Isnull(SUM(tgf.fSum), 0.0) AS fSum --镜架金额
                        FROM   S_OP_Optometry i5
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS fSum,
                                                 s_se_Sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_Sb_OptometryID
										UNION ALL 
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tfSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
													B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgf
                                 ON i5.s_op_oy_OptometryID = tgf.s_se_sb_OptometryID
                        GROUP  BY i5.s_op_oy_PersonID)f
               ON p.PersonID = f.S_OP_OY_PersonID
             LEFT JOIN (SELECT i6.S_OP_OY_PersonID
                               ,Isnull(SUM(tgh.hSum), 0.00) AS hSum --隐形金额
                        FROM   S_OP_Optometry i6
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS hSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS thSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgh
                                 ON i6.s_op_oy_OptometryID = tgh.s_se_sb_OptometryID
                        GROUP  BY i6.S_OP_OY_PersonID)h
               ON p.PersonID = h.S_OP_OY_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS lSum --老花镜金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)

        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_PersonID)glhj
               ON p.PersonID = glhj.S_OP_OY_PersonID
             LEFT JOIN (SELECT i4.S_OP_OY_PersonID
                               ,Isnull(SUM(tgs.gSum), 0.00) AS sSum --视光类金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        --AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_PersonID)gsgl
               ON p.PersonID = gsgl.S_OP_OY_PersonID
             LEFT JOIN (SELECT i7.s_op_oy_PersonID
                               --,isnull(sum(total.tSum),0.00) as tSum
                               --,isnull(sum(ttotal.ttSum),0.00) as ttSum
                               ,SUM(Isnull(ttotal.tSum, 0.00)) AS tSum --总金额
                        FROM   S_OP_Optometry i7
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS tSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
									UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS ttSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
       -- AND ((ISNULL('${queryPersonID}', '') <> '') AND (R_O_OS_personID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) ttotal
                                 ON i7.s_op_oy_OptometryID = ttotal.s_se_sb_OptometryID
                        GROUP  BY i7.s_op_oy_PersonID)t
               ON p.PersonID = t.s_op_oy_PersonID
             LEFT JOIN (
					select chh.S_CR_RD_CheckPerson as S_CR_RD_CheckPerson,sum(cNum) as cNum from(
						SELECT S_CR_RD_CheckPerson as S_CR_RD_CheckPerson,
                                                 count(S_CR_RD_CheckPerson)                        AS cNum
                                          FROM   S_CR_RegisteredDetails
										  Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   and F_RC_FeeType = '1'
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_CheckPerson
						union all
						SELECT S_CR_RD_CheckPerson as S_CR_RD_CheckPerson,
                                                 -count(S_CR_RD_CheckPerson)                        AS cNum
                                          FROM   S_CR_RegisteredDetails
										  Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   and F_RC_FeeType = '2'
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_CheckPerson)chh
					group by chh.S_CR_RD_CheckPerson
			)ch
               ON p.PersonID = ch.S_CR_RD_CheckPerson
             LEFT JOIN (SELECT S_CR_RD_CheckPerson,
                                                 SUM(S_CR_RD_Money)                        AS fmoneySum
                                          FROM   S_CR_RegisteredDetails
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_CheckPerson)c
               ON p.PersonID = c.S_CR_RD_CheckPerson
             
             LEFT JOIN (SELECT S_CR_RD_Register                 AS personid,
                               Isnull(SUM(S_CR_RD_Money), 0.00) AS xyfsum --西药费
                        FROM   S_CR_RegisteredDetails
                               INNER JOIN F_RegisteredCategory
                                 ON S_CR_RD_RegisteredID = F_RC_ID
                                    --inner join i_registered_print_details
                                    --on i_registered.registeredtype=i_registered_print_details.registeredid
                                    --where i_registered_print_details.flag='3'
                                    AND S_CR_RD_flag = '1'
                                    AND F_RC_RegisteredType = '2'
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_Register='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                        GROUP  BY S_CR_RD_Register)xyf
               ON p.PersonID = xyf.personid

      left join (SELECT S_OP_OY_PersonID                           AS personid,
                        count(*) as dcnum                                      --双眼视功能检查数
       FROM   S_OP_Optometry
              INNER JOIN SYS_PersonInfo
                ON S_OP_OY_PersonID = SYS_PersonInfo.ID
              INNER JOIN B_Departments
                ON S_OP_OY_ShopCode = B_DP_DepartmentID
              INNER JOIN S_ME_CustomerInfo
                ON S_ME_CI_CustomerID = S_OP_OY_CustomerID
                   AND S_OP_OY_OptometryID IN(SELECT S_OP_DE_OptometryID
                                              FROM   S_OP_DoubleEyeFunction where isnull(S_OP_DE_Account,'')='')
                   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
        AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
        AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
       group by S_OP_OY_PersonID)doublecheck on p.PersonID = doublecheck.personid

  where isnull(ygNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(sNum,0) <>0 or isnull(prNum,0) <> 0 or isnull(gSum,0) <>0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) <>0 or isnull(dcnum,0)<>0
     
    DROP TABLE #Optometry
    DROP TABLE #S_OP_Inspection
    DROP TABLE #uview_SalesBasic
	DROP TABLE #Registered
-------------------------------------------------------------------------------------------

end


drop table #salesDepartments]]></Query>
</TableData>
<TableData name="ds2" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="logincompanyid"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select 
*
from F_CompanyName
where F_CN_ID = '${logincompanyid}']]></Query>
</TableData>
<TableData name="ds3" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="customAmountName"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="lookWay"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="ShopCodeName"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="queryWay"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select top 1 '${customAmountName}' as customAmountName,'${ShopCodeName}' as ShopCodeName,'${queryWay}'  as queryWay,'${lookWay}' as lookWay
]]></Query>
</TableData>
<TableData name="ds4" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="bgndate"/>
<O>
<![CDATA[2014-05-01]]></O>
</Parameter>
<Parameter>
<Attributes name="enddate"/>
<O>
<![CDATA[2014-06-30]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select departmentID into #salesDepartments from sales_createShopCodeTab('${departmentid}')

select s_op_oy_PersonID
,sum(fjfy) as fjfy
from(select s_se_Sb_OptometryID
,cast(sum(S_SE_Amount*S_SE_Number) as decimal(18, 2)) as fjfy
 from 
S_SE_AdditionalCDetail
inner join uview_SalesBasic on S_SE_SB_SalesID=S_SE_SalesID 
AND CONVERT(VARCHAR(10), s_se_sb_PosDatetime, 23) >= CONVERT(VARCHAR(10),'${bgndate}', 23)
AND CONVERT(VARCHAR(10), s_se_sb_PosDatetime, 23) <= CONVERT(VARCHAR(10),'${enddate}', 23)
AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
group by s_se_Sb_OptometryID

union all

select s_se_Sb_OptometryID
,-cast(sum(S_SE_Amount*S_SE_Number) as decimal(18, 2)) as fjfy
 from 
S_SE_AdditionalCDetail
inner join uview_SalesBasic on S_SE_SB_SalesID=S_SE_SalesID 
AND CONVERT(VARCHAR(10), s_se_sb_withdrawDate, 23) >= CONVERT(VARCHAR(10),'${bgndate}', 23)
AND CONVERT(VARCHAR(10), s_se_sb_withdrawDate, 23) <= CONVERT(VARCHAR(10),'${enddate}', 23)
AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
group by s_se_Sb_OptometryID
)tt 
inner join S_OP_Optometry on s_op_oy_OptometryID = s_se_sb_OptometryID
where ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))

GROUP  BY s_op_oy_PersonID

drop table #salesDepartments
]]></Query>
</TableData>
</TableDataMap>
<Report class="com.fr.report.WorkSheet" name="sheet1">
<ReportPageAttr>
<HR F="0" T="8"/>
<FR F="11" T="11"/>
<HC/>
<FC/>
<UPFCR COLUMN="false" ROW="true"/>
</ReportPageAttr>
<RowHeight defaultValue="723900">
<![CDATA[914400,914400,914400,914400,914400,914400,144000,914400,914400,914400,914400,914400,723900]]></RowHeight>
<ColumnWidth defaultValue="2743200">
<![CDATA[0,576000,2743200,2667000,2095500,2781300,1752600,1790700,2705100,2016000,2016000,2016000,2016000,2016000,2514600,2743200,2057400,2590800,2286000,4343400,2743200]]></ColumnWidth>
<CellElementList>
<C c="2" r="0" cs="16" s="0">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="F_CN_ReportShowName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="2" r="1" cs="16" s="1">
<O>
<![CDATA[验光师工作量统计]]></O>
<Expand/>
</C>
<C c="2" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="4" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="5" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="6" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="7" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="8" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="9" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="10" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="2" r="3" s="2">
<O>
<![CDATA[部门名称：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="3" cs="8" s="3">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="ShopCodeName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[$$$]]></Result>
<Parameters/>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand dir="0"/>
</C>
<C c="12" r="3" cs="6" s="4">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[="查询日期：" + $bgndate + " 至 " + $enddate]]></Attributes>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="2" r="4" s="2">
<O>
<![CDATA[查询方式：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="4" cs="8" s="3">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="queryWay"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand dir="0"/>
</C>
<C c="0" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="2" r="5" s="2">
<O>
<![CDATA[查看分类：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="5" cs="8" s="3">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="lookWay"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand dir="0"/>
</C>
<C c="11" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="12" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="13" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="14" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="16" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="17" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="0" r="7">
<Expand/>
</C>
<C c="1" r="7">
<Expand/>
</C>
<C c="2" r="7" rs="2" s="5">
<O>
<![CDATA[工号]]></O>
<Expand/>
</C>
<C c="3" r="7" rs="2" s="5">
<O>
<![CDATA[验光师]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="4" r="7" rs="2" s="6">
<O>
<![CDATA[验光数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[1]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[2]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="5" r="7" rs="2" s="6">
<O>
<![CDATA[双眼视功能]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[13]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[14]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="6" r="7" rs="2" s="6">
<O>
<![CDATA[处方数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[15]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[16]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="7" r="7" rs="2" s="6">
<O>
<![CDATA[配镜数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[17]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[18]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="8" r="7" rs="2" s="6">
<O>
<![CDATA[打印处方数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[19]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[20]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="9" r="7" rs="2" s="6">
<O>
<![CDATA[镜片]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[21]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[22]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="10" r="7" rs="2" s="6">
<O>
<![CDATA[镜架]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[23]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[24]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="11" r="7" rs="2" s="6">
<O>
<![CDATA[隐形]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[25]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[26]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="12" r="7" rs="2" s="6">
<O>
<![CDATA[老花镜]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[27]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[28]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="13" r="7" rs="2" s="6">
<O>
<![CDATA[视光]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[29]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[30]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="14" r="7" cs="2" s="5">
<O>
<![CDATA[配镜单]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="16" r="7" rs="2" s="6">
<O>
<![CDATA[检查数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[33]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[34]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="17" r="7" rs="2" s="6">
<O>
<![CDATA[检查金额]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[35]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[36]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="18" r="7" rs="2" s="6">
<O>
<![CDATA[西药费]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[37]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[38]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="0" r="8">
<Expand/>
</C>
<C c="1" r="8">
<Expand/>
</C>
<C c="14" r="8" s="6">
<O>
<![CDATA[商品金额]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[31]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[32]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="15" r="8" s="7">
<O>
<![CDATA[附加费用]]></O>
<Expand/>
</C>
<C c="0" r="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="personid"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0" order="2">
<SortFormula>
<![CDATA[SWITCH($order, "1", -TODOUBLE(E10), "2", TODOUBLE(E10), "3", -TODOUBLE(E10), "4", TODOUBLE(E10), "5", -TODOUBLE(E10), "6", TODOUBLE(E10), "7", -TODOUBLE(E10), "8", TODOUBLE(E10), "9", -TODOUBLE(E10), "10", TODOUBLE(E10), "11", -TODOUBLE(E10), "12", TODOUBLE(E10), "13", -TODOUBLE(F10), "14", TODOUBLE(F10), "15", -TODOUBLE(G10), "16", TODOUBLE(G10), "17", -TODOUBLE(H10), "18", TODOUBLE(H10), "19", -TODOUBLE(I10), "20", TODOUBLE(I10), "21", -TODOUBLE(J10), "22", TODOUBLE(J10), "23", -TODOUBLE(K10), "24", TODOUBLE(K10), "25", -TODOUBLE(L10), "26", TODOUBLE(L10), "27", -TODOUBLE(M10), "28", TODOUBLE(M10), "29", -TODOUBLE(N10), "30", TODOUBLE(N10), "31", -TODOUBLE(O10), "32", TODOUBLE(O10), "33", -TODOUBLE(Q10), "34", TODOUBLE(Q10), "35", -TODOUBLE(R10), "36", TODOUBLE(R10), "37", -TODOUBLE(S10), "38", TODOUBLE(S10))]]></SortFormula>
</Expand>
</C>
<C c="1" r="9">
<Expand order="2"/>
</C>
<C c="2" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="personid"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="3" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="displayName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0" order="2"/>
</C>
<C c="4" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="ygksNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="5" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="dcnum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="6" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="pNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="7" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="pjdNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="8" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="dycfNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="9" r="9" s="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="gSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[3]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="optUserId"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<Content>
<![CDATA[

var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&departmentid="+departmentid+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&optUserId="+optUserId+"&endDate="+endDate+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;



openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="10" r="9" s="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="fSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[1]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="optUserId"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<Content>
<![CDATA[

var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&departmentid="+departmentid+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&optUserId="+optUserId+"&endDate="+endDate+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;




openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="11" r="9" s="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="hSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[4]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="optUserId"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<Content>
<![CDATA[

var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&departmentid="+departmentid+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&optUserId="+optUserId+"&endDate="+endDate+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;




openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="12" r="9" s="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="lSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[8]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="optUserId"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<Content>
<![CDATA[

var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&departmentid="+departmentid+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&optUserId="+optUserId+"&endDate="+endDate+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;




openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="13" r="9" s="9">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="sSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[9]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="optUserId"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<Content>
<![CDATA[

var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&departmentid="+departmentid+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&optUserId="+optUserId+"&endDate="+endDate+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;




openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="14" r="9" s="8">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(J10:N10))]]></Attributes>
</O>
<Expand dir="0"/>
</C>
<C c="15" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds4" columnName="fjfy"/>
<Condition class="com.fr.data.condition.ListCondition">
<JoinCondition join="0">
<Condition class="com.fr.data.condition.CommonCondition">
<CNUMBER>
<![CDATA[1]]></CNUMBER>
<CNAME>
<![CDATA[s_op_oy_PersonID]]></CNAME>
<Compare op="0">
<ColumnRow column="2" row="9"/>
</Compare>
</Condition>
</JoinCondition>
</Condition>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="16" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="cNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="17" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="fmoneySum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="18" r="9" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="xyfsum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="2" r="10" cs="2" s="10">
<O>
<![CDATA[合计：]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="4" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(E10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="5" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(F10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="6" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(G10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="7" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(H10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="8" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(I10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="9" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(J10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="10" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(K10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="11" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(L10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="12" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(M10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="13" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(N10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="14" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(O10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="15" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(P10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="16" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(Q10)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="17" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(R10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="18" r="10" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(S10))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="2" r="11" s="3">
<O>
<![CDATA[打印日期：]]></O>
<Expand/>
</C>
<C c="3" r="11" cs="4" s="3">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=today()]]></Attributes>
</O>
<Expand/>
</C>
<C c="11" r="11" cs="8" s="4">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[="页次:第 " + $$page_number + " 页/共 " + $$totalPage_number + " 页"]]></Attributes>
</O>
<Expand/>
</C>
</CellElementList>
<ReportAttrSet>
<ReportSettings headerHeight="0" footerHeight="0">
<PaperSetting orientation="1">
<Margin top="986400" left="0" bottom="986400" right="0"/>
</PaperSetting>
</ReportSettings>
<Header reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Header>
<Footer reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Footer>
</ReportAttrSet>
</Report>
<ReportParameterAttr>
<Attributes showWindow="false" delayPlaying="true" windowPosition="1" align="1"/>
<PWTitle>
<![CDATA[参数]]></PWTitle>
</ReportParameterAttr>
<StyleList>
<Style imageLayout="1">
<FRFont name="黑体" style="1" size="112"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="120"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="2" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="4" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72" foreground="-16776961" underline="1"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1" color="-16777216"/>
<Bottom style="1" color="-16777216"/>
<Left style="1" color="-16777216"/>
<Right style="1" color="-16777216"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72" foreground="-16776961" underline="1"/>
<Background name="NullBackground"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72" foreground="-65536"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
</StyleList>
</WorkBook>
