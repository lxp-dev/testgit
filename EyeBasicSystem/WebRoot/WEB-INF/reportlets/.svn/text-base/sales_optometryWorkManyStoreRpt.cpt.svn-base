<?xml version="1.0" encoding="UTF-8"?>
<WorkBook xmlVersion="20120529" releaseVersion="7.0.0">
<TableDataMap>
<TableData name="ds1" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="queryPersonID"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="bgndate"/>
<O>
<![CDATA[2013-11-18]]></O>
</Parameter>
<Parameter>
<Attributes name="enddate"/>
<O>
<![CDATA[2013-11-18]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[

select departmentID into #salesDepartments from sales_createShopCodeTab('${departmentid}')
------------------------------------------------------------------------------------

if ('${bgndate}'<convert(varchar(10),getdate(),120))
begin


if ('${enddate}'<convert(varchar(10),getdate(),120))
begin

select ('${bgndate}'+'--'+'${enddate}') as queryDate,departmentName as departmentName,displayName as displayName, 
	sum(ygksNum) as ygksNum,
	sum(pNum) as pNum,
	sum(pjdNum) as pjdNum,
	sum(dycfNum) as dycfNum,
    sum(gSum) as gSum,
	sum(fSum) as fSum,
	sum(hSum) as hSum,
	sum(lSum) as lSum,
	sum(sSum) as sSum,
	sum(tSum) as tSum,
	sum(cNum) as cNum,
	sum(fmoneySum) as fmoneySum,
	sum(xyfsum) as xyfsum,
	sum(isnull(dcnum,0)) as dcnum
  from (

select R_O_OS_DepartmentId as displayName,B_DP_DepartmentName as departmentName, 
	sum(R_O_OS_ygksNum) as ygksNum,
	sum(R_O_OS_pNum) as pNum,
	sum(R_O_OS_pjdNum) as pjdNum,
	sum(R_O_OS_dycfNum) as dycfNum,
	sum(R_O_OS_gSum) as gSum,
	sum(R_O_OS_fSum) as fSum,
	sum(R_O_OS_hSum) as hSum,
	sum(R_O_OS_lSum) as lSum,
	sum(R_O_OS_sSum) as sSum,
	sum(R_O_OS_tSum) as tSum,
	0 as cNum,
	0 as fmoneySum,
	sum(R_O_OS_xyfsum) as xyfsum,
	sum(R_O_OS_dcNum) as dcnum
  from R_optometryOnlyStore inner join B_Departments on R_O_OS_DepartmentId=B_DP_DepartmentID
  where ((ISNULL('${departmentid}', '') <> '') AND (R_O_OS_DepartmentId in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and R_O_OS_Date>='${bgndate}' 
	and R_O_OS_Date<='${enddate}'
  group by R_O_OS_DepartmentId,B_DP_DepartmentName
union all
select S_CR_RD_ShopCode as displayName,B_DP_DepartmentName as departmentName, 
		0 as ygksNum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		count(S_CR_RD_ShopCode) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		0 as dcnum
	from S_CR_RegisteredDetails 
	inner join B_Departments on S_CR_RD_ShopCode = B_DP_DepartmentID
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}'
	and F_RC_FeeType = '1'
	and isnull(S_CR_RD_CheckPerson,'') <> ''  
	group by S_CR_RD_ShopCode,B_DP_DepartmentName

union all
select S_CR_RD_ShopCode as displayName,B_DP_DepartmentName as departmentName, 
		0 as ygksNum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		-count(S_CR_RD_ShopCode) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		0 as dcnum
	from S_CR_RegisteredDetails 
	inner join B_Departments on S_CR_RD_ShopCode = B_DP_DepartmentID
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> '' 
	and F_RC_FeeType = '2'
	group by S_CR_RD_ShopCode,B_DP_DepartmentName
)temp
  where isnull(ygksNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(pjdNum,0) <>0 or isnull(dycfNum,0) <> 0 or isnull(gSum,0) <> 0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) <>0 
group by departmentName,displayName
end
else
begin

      SELECT S_OP_OY_ShopCode
      INTO   #Optometry1
      FROM   S_OP_Optometry
	  WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
			 AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      GROUP  BY S_OP_OY_ShopCode
      ORDER  BY S_OP_OY_ShopCode

      SELECT S_OP_OY_ShopCode
      INTO   #S_OP_Inspection1
      FROM   S_OP_Inspection
             INNER JOIN S_OP_Optometry
               ON S_OP_OY_OptometryID = S_OP_IP_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      ORDER  BY S_OP_OY_ShopCode

      SELECT S_SE_SB_ShopCode
      INTO   #S_se_SalesBasic1
      FROM   S_OP_Optometry
             INNER JOIN uview_SalesBasic
               ON S_SE_SB_OptometryID = S_OP_OY_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_SE_SB_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      GROUP  BY S_SE_SB_ShopCode
      ORDER  BY S_SE_SB_ShopCode

	  SELECT S_CR_RD_ShopCode
      INTO   #Registered1
      FROM   S_CR_RegisteredDetails
      WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
			 AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      ORDER  BY S_CR_RD_ShopCode


select ('${bgndate}'+'--'+'${enddate}') as queryDate,
    departmentName as departmentName,displayName as displayName, 
	ygksNum as ygksNum,
	pNum as pNum,
	pjdNum as pjdNum,
	dycfNum as dycfNum,
    gSum as gSum,
	fSum as fSum,
	hSum as hSum,
	lSum as lSum,
	sSum as sSum,
	tSum as tSum,
	cNum as cNum,
	fmoneySum as fmoneySum,
	xyfsum as xyfsum,
	dcnum as dcnum
 from (

select departmentName as departmentName,displayName as displayName, 
	sum(ygksNum) as ygksNum,
	sum(pNum) as pNum,
	sum(pjdNum) as pjdNum,
	sum(dycfNum) as dycfNum,
    sum(gSum) as gSum,
	sum(fSum) as fSum,
	sum(hSum) as hSum,
	sum(lSum) as lSum,
	sum(sSum) as sSum,
    sum(tSum) as tSum,
	sum(cNum) as cNum,
	sum(fmoneySum) as fmoneySum,
	sum(xyfsum) as xyfsum,
	sum(dcnum) as dcnum
	 from (

select R_O_OS_DepartmentId as displayName,B_DP_DepartmentName as departmentName, 
	sum(R_O_OS_ygksNum) as ygksNum,
	sum(R_O_OS_pNum) as pNum,
	sum(R_O_OS_pjdNum) as pjdNum,
	sum(R_O_OS_dycfNum) as dycfNum,
	sum(R_O_OS_gSum) as gSum,
	sum(R_O_OS_fSum) as fSum,
	sum(R_O_OS_hSum) as hSum,
	sum(R_O_OS_lSum) as lSum,
	sum(R_O_OS_sSum) as sSum,
    sum(R_O_OS_tSum) as tSum,
	0 as cNum,
	0 as fmoneySum,
	sum(R_O_OS_xyfsum) as xyfsum,
	sum(R_O_OS_dcNum) as dcNum
  from R_optometryOnlyStore inner join B_Departments on R_O_OS_DepartmentId=B_DP_DepartmentID
  where ((ISNULL('${departmentid}', '') <> '') AND (R_O_OS_DepartmentId in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) and R_O_OS_Date>='${bgndate}' and R_O_OS_Date<=convert(char(10), dateadd(day,-1,'${enddate}'),120)
  group by R_O_OS_DepartmentId,B_DP_DepartmentName

union all
select S_CR_RD_ShopCode as displayName,B_DP_DepartmentName as departmentName, 
		0 as ygksNum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		count(S_CR_RD_ShopCode) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		0 as dcnum
	from S_CR_RegisteredDetails 
	inner join B_Departments on S_CR_RD_ShopCode = B_DP_DepartmentID
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> '' 
	and F_RC_FeeType = '1'
	group by S_CR_RD_ShopCode,B_DP_DepartmentName

union all
select S_CR_RD_ShopCode as displayName,B_DP_DepartmentName as departmentName, 
		0 as ygksNum,
		0 as pNum,
		0 as pjdNum,
		0 as dycfNum,
		0 as gSum,
		0 as fSum,
		0 as hSum,
		0 as lSum,
		0 as sSum,
		0 as tSum,
		-count(S_CR_RD_ShopCode) as cNum,
		sum(S_CR_RD_Money) as fmoneySum,
		0 as xyfsum,
		0 as dcnum
	from S_CR_RegisteredDetails 
	inner join B_Departments on S_CR_RD_ShopCode = B_DP_DepartmentID
	Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
	where ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = '')) 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) >= '${bgndate}' 
	and convert(varchar(10),S_CR_RD_FactCasherDate,23) <= '${enddate}' 
	and isnull(S_CR_RD_CheckPerson,'') <> '' 
	and F_RC_FeeType = '2'
	group by S_CR_RD_ShopCode,B_DP_DepartmentName

union all
----------------------------------------------
      SELECT p.PersonID as displayName,
             departmentName as departmentName,
             ygNum as ygksNum,pNum as pNum,sNum as pjdNum,prNum as dycfNum,gSum as gSum
             ,fSum as fSum,hSum as hSum,lSum as lSum,sSum as sSum,tSum as tSum,0 as cNum,0 as fmoneySum,xyfsum as xyfsum 
			 ,dcnum as dcnum

      FROM   (SELECT p.B_DP_DepartmentID AS PersonID,
                     p.B_DP_DepartmentName as departmentName
              FROM   B_Departments p
                     INNER JOIN (SELECT *
                                 FROM   #Optometry1
                                 UNION
                                 SELECT *
                                 FROM   #S_OP_Inspection1
                                 UNION
                                 SELECT *
                                 FROM   #S_se_SalesBasic1
								 UNION
                                 SELECT *
                                 FROM   #Registered1)person
                       ON person.S_OP_OY_ShopCode = p.B_DP_DepartmentID)p
			 LEFT JOIN (select S_OP_R_shopcode,isnull(count(S_OP_R_CustomerID),0) as ygNum from dbo.S_OP_Refractive
						where convert(varchar(10),S_OP_R_Inspection_date,23) >= CONVERT(VARCHAR(10),getdate(), 23)
						and	  convert(varchar(10),S_OP_R_Inspection_date,23) <= CONVERT(VARCHAR(10),getdate(), 23)
						and	  ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
						group by S_OP_R_shopcode)yg
				ON p.PersonID = yg.S_OP_R_shopcode
             LEFT JOIN (SELECT i1.S_OP_OY_ShopCode,
                               SUM(op.pNum) AS pNum
                        FROM   S_OP_Optometry i1
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS pNum --处方单数
                                                 ,
                                                 S_OP_IP_OptometryID
                                          FROM   S_OP_Inspection
                                          GROUP  BY S_OP_IP_OptometryID) op
                                 ON i1.S_OP_OY_OptometryID = op.S_OP_IP_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                               AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND S_OP_OY_Flag = '1'
						GROUP  BY i1.S_OP_OY_ShopCode)pr
               ON p.PersonID = pr.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i2.S_OP_OY_ShopCode
                               --,isnull(sum(sp.sNum),0) as sNum
                               --,isnull(sum(tsp.tsNum),0) as tsNum
                               ,
                               Isnull(SUM(sp.sNum), 0) + Isnull(SUM(tsp.tsNum), 0) AS sNum --配镜单数
                        FROM   S_OP_Optometry i2
                               LEFT JOIN (SELECT COUNT(S_SE_SB_SalesID) AS sNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) sp
                                 ON i2.S_OP_OY_OptometryID = sp.S_SE_SB_OptometryID
                               LEFT JOIN (SELECT COUNT(s_se_sb_salesid) AS tsNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) tsp
                                 ON i2.S_OP_OY_OptometryID = tsp.S_SE_SB_OptometryID
                        GROUP  BY i2.S_OP_OY_ShopCode)s
               ON p.PersonID = s.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i3.S_OP_OY_ShopCode,
                               SUM(opp.prNum) AS prNum --打印处方数
                        FROM   S_OP_Optometry i3
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS prNum,
                                                 s_op_ip_OptometryID
                                          FROM   S_OP_Inspection
                                          WHERE  s_op_ip_PrintFlag = '1'
                                          GROUP  BY s_op_ip_OptometryID)opp
                                 ON i3.s_op_oy_OptometryID = opp.s_op_ip_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                               AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                        GROUP  BY i3.S_OP_OY_ShopCode)pp
               ON p.PersonID = pp.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS gSum --镜片金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)g
               ON p.PersonID = g.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i5.S_OP_OY_ShopCode
                               --,isnull(sum(gf.fSum),0.0) as fSum
                               --,isnull(sum(tgf.tfsum),0.0) as tfsum
                               ,Isnull(SUM(tgf.fSum), 0.0) AS fSum --镜架金额
                        FROM   S_OP_Optometry i5
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS fSum,
                                                 s_se_Sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_Sb_OptometryID
										UNION ALL 
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tfSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
													B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgf
                                 ON i5.s_op_oy_OptometryID = tgf.s_se_sb_OptometryID
                        GROUP  BY i5.S_OP_OY_ShopCode)f
               ON p.PersonID = f.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i6.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgh.hSum), 0.00) AS hSum --隐形金额
                        FROM   S_OP_Optometry i6
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS hSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS thSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgh
                                 ON i6.s_op_oy_OptometryID = tgh.s_se_sb_OptometryID
                        GROUP  BY i6.S_OP_OY_ShopCode)h
               ON p.PersonID = h.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS lSum --老花镜金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)glhj
               ON p.PersonID = glhj.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS sSum --视光类金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)gsgl
               ON p.PersonID = gsgl.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i7.S_OP_OY_ShopCode
                               --,isnull(sum(total.tSum),0.00) as tSum
                               --,isnull(sum(ttotal.ttSum),0.00) as ttSum
                               ,SUM(Isnull(ttotal.tSum, 0.00)) AS tSum --总金额
                        FROM   S_OP_Optometry i7
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS tSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
									UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS ttSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) ttotal
                                 ON i7.s_op_oy_OptometryID = ttotal.s_se_sb_OptometryID
                        GROUP  BY i7.S_OP_OY_ShopCode)t
               ON p.PersonID = t.S_OP_OY_ShopCode
             LEFT JOIN (SELECT COUNT(s_op_oy_OptometryID) AS cNum --检查数
                               ,S_OP_OY_ShopCode
                        FROM   S_OP_Optometry
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                               AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                        GROUP  BY S_OP_OY_ShopCode)ch
               ON p.PersonID = ch.S_OP_OY_ShopCode
             LEFT JOIN (SELECT S_CR_RD_ShopCode,
                                                 SUM(S_CR_RD_Money)                        AS fmoneySum
                                          FROM   S_CR_RegisteredDetails
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_ShopCode)c
               ON p.PersonID = c.S_CR_RD_ShopCode
             
             LEFT JOIN (SELECT S_CR_RD_ShopCode                 AS personid,
                               Isnull(SUM(S_CR_RD_Money), 0.00) AS xyfsum --西药费
                        FROM   S_CR_RegisteredDetails
                               INNER JOIN F_RegisteredCategory
                                 ON S_CR_RD_RegisteredID = F_RC_ID
                                    --inner join i_registered_print_details
                                    --on i_registered.registeredtype=i_registered_print_details.registeredid
                                    --where i_registered_print_details.flag='3'
                                    AND S_CR_RD_flag = '1'
                                    AND F_RC_RegisteredType = '2'
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                    AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                        GROUP  BY S_CR_RD_ShopCode)xyf
               ON p.PersonID = xyf.personid
			left join (SELECT S_OP_OY_PersonID                           AS personid,
                        count(*) as dcnum                                      --双眼视功能检查数
			   FROM   S_OP_Optometry
					  INNER JOIN SYS_PersonInfo
						ON S_OP_OY_PersonID = SYS_PersonInfo.ID
					  INNER JOIN B_Departments
						ON S_OP_OY_ShopCode = B_DP_DepartmentID
					  INNER JOIN S_ME_CustomerInfo
						ON S_ME_CI_CustomerID = S_OP_OY_CustomerID
						   AND S_OP_OY_OptometryID IN(SELECT S_OP_DE_OptometryID
													  FROM   S_OP_DoubleEyeFunction where isnull(S_OP_DE_Account,'')='')
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
				AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
				AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
						   AND S_OP_OY_Flag = '1'
			   group by S_OP_OY_PersonID)doublecheck on p.PersonID = doublecheck.personid

)temp
 group by departmentName,displayName

)temp
  where isnull(ygksNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(pjdNum,0) <>0 or isnull(dycfNum,0) <> 0 or isnull(gSum,0) <> 0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) <>0 

        DROP TABLE #Optometry1
        DROP TABLE #S_OP_Inspection1
        DROP TABLE #S_se_SalesBasic1
		DROP TABLE #Registered1

end

end
else
begin

-------------------------------------------------

      SELECT S_OP_OY_ShopCode
      INTO   #Optometry
      FROM   S_OP_Optometry
      WHERE  ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      GROUP  BY S_OP_OY_ShopCode
      ORDER  BY S_OP_OY_ShopCode

      SELECT S_OP_OY_ShopCode
      INTO   #S_OP_Inspection
      FROM   S_OP_Inspection
             INNER JOIN S_OP_Optometry
               ON S_OP_OY_OptometryID = S_OP_IP_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      ORDER  BY S_OP_OY_ShopCode

      SELECT S_SE_SB_ShopCode
      INTO   #uview_SalesBasic
      FROM   S_OP_Optometry
             INNER JOIN uview_SalesBasic
               ON S_SE_SB_OptometryID = S_OP_OY_OptometryID
      WHERE  CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_SE_SB_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
      GROUP  BY S_SE_SB_ShopCode
      ORDER  BY S_SE_SB_ShopCode

	  SELECT S_CR_RD_ShopCode
      INTO   #Registered
      FROM   S_CR_RegisteredDetails
      WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
             AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
			 AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
	  Group by S_CR_RD_ShopCode
      ORDER  BY S_CR_RD_ShopCode

      SELECT ('${bgndate}'+'--'+'${enddate}') as queryDate,
             p.PersonID as displayName,departmentName as departmentName,
             ygNum as ygksNum,pNum as pNum,sNum as pjdNum,prNum as dycfNum,gSum as gSum,dcnum as dcnum
             ,fSum as fSum,hSum as hSum,lSum as lSum,sSum as sSum,tSum as tSum,cNum as cNum,fmoneySum as fmoneySum,xyfsum as xyfsum 

      FROM   (SELECT p.B_DP_DepartmentID AS PersonID,
                     p.B_DP_DepartmentName as departmentName
              FROM   B_Departments p
                     INNER JOIN (SELECT *
                                 FROM   #Optometry
                                 UNION
                                 SELECT *
                                 FROM   #S_OP_Inspection
                                 UNION
                                 SELECT *
                                 FROM   #uview_SalesBasic
								 UNION
                                 SELECT *
                                 FROM   #Registered)person
                       ON person.S_OP_OY_ShopCode = p.B_DP_DepartmentID)p
			 LEFT JOIN (select S_OP_R_shopcode,isnull(count(S_OP_R_CustomerID),0) as ygNum from dbo.S_OP_Refractive
						where convert(varchar(10),S_OP_R_Inspection_date,23) >= CONVERT(VARCHAR(10),getdate(), 23)
						and	  convert(varchar(10),S_OP_R_Inspection_date,23) <= CONVERT(VARCHAR(10),getdate(), 23)
						--and	  S_OP_R_shopcode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_R_shopcode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
						group by S_OP_R_shopcode)yg
				ON p.PersonID = yg.S_OP_R_shopcode
             LEFT JOIN (SELECT i1.S_OP_OY_ShopCode,
                               SUM(op.pNum) AS pNum
                        FROM   S_OP_Optometry i1
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS pNum --处方单数
                                                 ,
                                                 S_OP_IP_OptometryID
                                          FROM   S_OP_Inspection
                                          GROUP  BY S_OP_IP_OptometryID) op
                                 ON i1.S_OP_OY_OptometryID = op.S_OP_IP_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                            --   AND S_OP_OY_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
             AND S_OP_OY_Flag = '1'            
			GROUP  BY i1.S_OP_OY_ShopCode)pr
               ON p.PersonID = pr.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i2.S_OP_OY_ShopCode
                               --,isnull(sum(sp.sNum),0) as sNum
                               --,isnull(sum(tsp.tsNum),0) as tsNum
                               ,
                               Isnull(SUM(sp.sNum), 0) + Isnull(SUM(tsp.tsNum), 0) AS sNum --配镜单数
                        FROM   S_OP_Optometry i2
                               LEFT JOIN (SELECT COUNT(S_SE_SB_SalesID) AS sNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) sp
                                 ON i2.S_OP_OY_OptometryID = sp.S_SE_SB_OptometryID
                               LEFT JOIN (SELECT COUNT(s_se_sb_salesid) AS tsNum,
                                                 S_SE_SB_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY S_SE_SB_OptometryID) tsp
                                 ON i2.S_OP_OY_OptometryID = tsp.S_SE_SB_OptometryID
                        GROUP  BY i2.S_OP_OY_ShopCode)s
               ON p.PersonID = s.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i3.S_OP_OY_ShopCode,
                               SUM(opp.prNum) AS prNum --打印处方数
                        FROM   S_OP_Optometry i3
                               LEFT JOIN (SELECT COUNT(S_OP_IP_ID) AS prNum,
                                                 s_op_ip_OptometryID
                                          FROM   S_OP_Inspection
                                          WHERE  s_op_ip_PrintFlag = '1'
                                          GROUP  BY s_op_ip_OptometryID)opp
                                 ON i3.s_op_oy_OptometryID = opp.s_op_ip_OptometryID
                        WHERE  CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                             --  AND S_OP_OY_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                        GROUP  BY i3.S_OP_OY_ShopCode)pp
               ON p.PersonID = pp.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS gSum --镜片金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                           --      AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '3'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                             --    AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)g
               ON p.PersonID = g.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i5.S_OP_OY_ShopCode
                               --,isnull(sum(gf.fSum),0.0) as fSum
                               --,isnull(sum(tgf.tfsum),0.0) as tfsum
                               ,Isnull(SUM(tgf.fSum), 0.0) AS fSum --镜架金额
                        FROM   S_OP_Optometry i5
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS fSum,
                                                 s_se_Sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                             --    AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_Sb_OptometryID
										UNION ALL 
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tfSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
													B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                  and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '1'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                            --     AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgf
                                 ON i5.s_op_oy_OptometryID = tgf.s_se_sb_OptometryID
                        GROUP  BY i5.S_OP_OY_ShopCode)f
               ON p.PersonID = f.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i6.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgh.hSum), 0.00) AS hSum --隐形金额
                        FROM   S_OP_Optometry i6
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS hSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                             --    AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS thSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 AND s_se_sd_CommoditiesFlag = '4'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgh
                                 ON i6.s_op_oy_OptometryID = tgh.s_se_sb_OptometryID
                        GROUP  BY i6.S_OP_OY_ShopCode)h
               ON p.PersonID = h.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS lSum --老花镜金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                            --     AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '8'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                            --     AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)glhj
               ON p.PersonID = glhj.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i4.S_OP_OY_ShopCode
                               ,Isnull(SUM(tgs.gSum), 0.00) AS sSum --视光类金额
                        FROM   S_OP_Optometry i4
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS gSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
												 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                               --  AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
										union all
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), d.s_se_sd_salesvalue)) AS tgSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic b,
                                                 uview_SalesDetail d,
												 B_GoodsInfo g
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND b.s_se_sb_salesid = d.s_se_sd_salesid
                                                 and g.B_GI_GoodsID = d.S_SE_SD_SalesItemID
                                                 AND B_GI_GoodsCategoryID = '9'
												 and B_GI_SupplierID <>'ZZ'
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), b.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) tgs
                                 ON i4.s_op_oy_OptometryID = tgs.s_se_sb_OptometryID
                        GROUP  BY i4.S_OP_OY_ShopCode)gsgl
               ON p.PersonID = gsgl.S_OP_OY_ShopCode
             LEFT JOIN (SELECT i7.S_OP_OY_ShopCode
                               --,isnull(sum(total.tSum),0.00) as tSum
                               --,isnull(sum(ttotal.ttSum),0.00) as ttSum
                               ,SUM(Isnull(ttotal.tSum, 0.00)) AS tSum --总金额
                        FROM   S_OP_Optometry i7
                               LEFT JOIN (SELECT SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS tSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 --and (s_se_sb_withdrawflag is null)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.S_SE_SB_FactPosDatetime, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID
									UNION ALL
										  SELECT -SUM(CONVERT(NUMERIC(18, 2), s_se_sb_salesvalue)) AS ttSum,
                                                 s_se_sb_OptometryID
                                          FROM   uview_SalesBasic
                                          WHERE  S_se_Sb_valueflag = 1
                                                 AND ( s_se_sb_withdrawflag = 1 )
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                                 AND CONVERT(VARCHAR(10), uview_SalesBasic.s_se_sb_FactwithdrawDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                              --   AND S_se_sb_ShopCode  in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                                          GROUP  BY s_se_sb_OptometryID) ttotal
                                 ON i7.s_op_oy_OptometryID = ttotal.s_se_sb_OptometryID
                        GROUP  BY i7.S_OP_OY_ShopCode)t
               ON p.PersonID = t.S_OP_OY_ShopCode
             LEFT JOIN (
					select chh.S_CR_RD_ShopCode as S_CR_RD_ShopCode,sum(cNum) as cNum from(
						SELECT S_CR_RD_ShopCode as S_CR_RD_ShopCode,
                                                 count(S_CR_RD_ShopCode)                        AS cNum
                                          FROM   S_CR_RegisteredDetails
										  Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   and F_RC_FeeType = '1'
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_ShopCode
						union all
						SELECT S_CR_RD_ShopCode,
                                                 -count(S_CR_RD_ShopCode)                        AS cNum
                                          FROM   S_CR_RegisteredDetails
										  Inner join F_RegisteredCategory on F_RC_ID = S_CR_RD_RegisteredID
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   and F_RC_FeeType = '2'
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_ShopCode)chh
					group by chh.S_CR_RD_ShopCode
			)ch
               ON p.PersonID = ch.S_CR_RD_ShopCode
             LEFT JOIN (SELECT S_CR_RD_ShopCode,
                                                 SUM(S_CR_RD_Money)                        AS fmoneySum
                                          FROM   S_CR_RegisteredDetails
                        WHERE  CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                               AND CONVERT(VARCHAR(10), S_CR_RD_FactCasherDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
							   and isnull(S_CR_RD_CheckPerson,'') <> '' 
							   AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
							   AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_CR_RD_CheckPerson='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
                                          GROUP  BY S_CR_RD_ShopCode)c
               ON p.PersonID = c.S_CR_RD_ShopCode
             
             LEFT JOIN (SELECT S_CR_RD_ShopCode                 AS personid,
                               Isnull(SUM(S_CR_RD_Money), 0.00) AS xyfsum --西药费
                        FROM   S_CR_RegisteredDetails
                               INNER JOIN F_RegisteredCategory
                                 ON S_CR_RD_RegisteredID = F_RC_ID
                                    --inner join i_registered_print_details
                                    --on i_registered.registeredtype=i_registered_print_details.registeredid
                                    --where i_registered_print_details.flag='3'
                                    AND S_CR_RD_flag = '1'
                                    AND F_RC_RegisteredType = '2'
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
                                    AND CONVERT(VARCHAR(10), S_CR_RD_OptDate, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
                                --    AND S_CR_RD_ShopCode in (select departmentID from #salesDepartments)
             AND ((ISNULL('${departmentid}', '') <> '') AND (S_CR_RD_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
                        GROUP  BY S_CR_RD_ShopCode)xyf
               ON p.PersonID = xyf.personid

			left join (SELECT S_OP_OY_ShopCode                           AS personid,
                        count(*) as dcnum                                      --双眼视功能检查数
			   FROM   S_OP_Optometry
					  INNER JOIN SYS_PersonInfo
						ON S_OP_OY_PersonID = SYS_PersonInfo.ID
					  INNER JOIN B_Departments
						ON S_OP_OY_ShopCode = B_DP_DepartmentID
					  INNER JOIN S_ME_CustomerInfo
						ON S_ME_CI_CustomerID = S_OP_OY_CustomerID
						   AND S_OP_OY_OptometryID IN(SELECT S_OP_DE_OptometryID
													  FROM   S_OP_DoubleEyeFunction where isnull(S_OP_DE_Account,'')='')
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) >= CONVERT(VARCHAR(10),getdate(), 23)
						   AND CONVERT(VARCHAR(10), S_OP_OY_Time, 23) <= CONVERT(VARCHAR(10),getdate(), 23)
				AND ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
				AND ((ISNULL('${queryPersonID}', '') <> '') AND (S_OP_OY_PersonID='${queryPersonID}') OR (ISNULL('${queryPersonID}', '') = ''))
			   group by S_OP_OY_ShopCode)doublecheck on p.PersonID = doublecheck.personid

      where isnull(ygNum,0) <> 0 or isnull(pNum,0) <>0 or isnull(sNum,0) <>0 or isnull(prNum,0) <> 0 or isnull(gSum,0) <> 0 
  or isnull(fSum,0)  <>0 or isnull(hSum,0) <>0 or isnull(tSum,0) <>0 or isnull(cNum,0) <>0 or isnull(fmoneySum,0) <>0 or isnull(xyfsum,0) <>0 
  or isnull(lSum,0) <>0 or isnull(sSum,0) <>0 

        DROP TABLE #Optometry
        DROP TABLE #S_OP_Inspection
        DROP TABLE #uview_SalesBasic
		DROP TABLE #Registered
-------------------------------------------------------------------------------------------

end

-------------------------------------------------------------------------------------------
drop table #salesDepartments


]]></Query>
</TableData>
<TableData name="ds2" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="logincompanyid"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select 
*
from F_CompanyName
where F_CN_ID = '${logincompanyid}']]></Query>
</TableData>
<TableData name="ds3" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="customAmountName"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="lookWay"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="ShopCodeName"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="queryWay"/>
<O>
<![CDATA[]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select top 1 '${customAmountName}' as customAmountName,'${ShopCodeName}' as ShopCodeName,'${queryWay}'  as queryWay,'${lookWay}' as lookWay

]]></Query>
</TableData>
<TableData name="ds4" class="com.fr.data.impl.DBTableData">
<Parameters>
<Parameter>
<Attributes name="departmentid"/>
<O>
<![CDATA[000]]></O>
</Parameter>
<Parameter>
<Attributes name="bgndate"/>
<O>
<![CDATA[2014-05-01]]></O>
</Parameter>
<Parameter>
<Attributes name="enddate"/>
<O>
<![CDATA[2014-06-30]]></O>
</Parameter>
</Parameters>
<Attributes maxMemRowCount="-1"/>
<Connection class="com.fr.data.impl.NameDatabaseConnection">
<DatabaseName>
<![CDATA[datasource]]></DatabaseName>
</Connection>
<Query>
<![CDATA[select departmentID into #salesDepartments from sales_createShopCodeTab('${departmentid}')

select S_OP_OY_ShopCode
,sum(fjfy) as fjfy
from(select s_se_Sb_OptometryID
,cast(sum(S_SE_Amount*S_SE_Number) as decimal(18, 2)) as fjfy
 from 
S_SE_AdditionalCDetail
inner join uview_SalesBasic on S_SE_SB_SalesID=S_SE_SalesID 
AND CONVERT(VARCHAR(10), s_se_sb_PosDatetime, 23) >= CONVERT(VARCHAR(10),'${bgndate}', 23)
AND CONVERT(VARCHAR(10), s_se_sb_PosDatetime, 23) <= CONVERT(VARCHAR(10),'${enddate}', 23)
AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
group by s_se_Sb_OptometryID

union all

select s_se_Sb_OptometryID
,-cast(sum(S_SE_Amount*S_SE_Number) as decimal(18, 2)) as fjfy
 from 
S_SE_AdditionalCDetail
inner join uview_SalesBasic on S_SE_SB_SalesID=S_SE_SalesID 
AND CONVERT(VARCHAR(10), s_se_sb_withdrawDate, 23) >= CONVERT(VARCHAR(10),'${bgndate}', 23)
AND CONVERT(VARCHAR(10), s_se_sb_withdrawDate, 23) <= CONVERT(VARCHAR(10),'${enddate}', 23)
AND ((ISNULL('${departmentid}', '') <> '') AND (S_se_sb_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))
group by s_se_Sb_OptometryID
)tt 
inner join S_OP_Optometry on s_op_oy_OptometryID = s_se_sb_OptometryID
where ((ISNULL('${departmentid}', '') <> '') AND (S_OP_OY_ShopCode in (select departmentID from #salesDepartments)) OR (ISNULL('${departmentid}', '') = ''))

GROUP  BY S_OP_OY_ShopCode

drop table #salesDepartments
]]></Query>
</TableData>
</TableDataMap>
<ReportWebAttr>
<WebPageContent>
<ToolBars>
<ToolBarManager>
<Location>
<Embed position="1"/>
</Location>
<ToolBar>
<Widget class="com.fr.report.web.ui.impl.page.First">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('ReportServerP-First')}]]></Text>
<IconName>
<![CDATA[first]]></IconName>
</Widget>
<Widget class="com.fr.report.web.ui.impl.page.Previous">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('ReportServerP-Previous')}]]></Text>
<IconName>
<![CDATA[previous]]></IconName>
</Widget>
<Widget class="com.fr.report.web.ui.impl.page.PageNavi">
<WidgetAttr/>
</Widget>
<Widget class="com.fr.report.web.ui.impl.page.Next">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('ReportServerP-Next')}]]></Text>
<IconName>
<![CDATA[next]]></IconName>
</Widget>
<Widget class="com.fr.report.web.ui.impl.page.Last">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('ReportServerP-Last')}]]></Text>
<IconName>
<![CDATA[last]]></IconName>
</Widget>
<Widget class="com.fr.report.web.ui.impl.FlashPrint">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('Utils-Print[Client]A')}]]></Text>
<IconName>
<![CDATA[flashprint]]></IconName>
</Widget>
<Widget class="com.fr.report.web.ui.impl.Export">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('Export')}]]></Text>
<IconName>
<![CDATA[export]]></IconName>
<Buttons pdf="true" excelP="true" excelO="true" excelS="true" word="true" image="true" html="true"/>
</Widget>
<Widget class="com.fr.report.web.ui.impl.page.SetPrinterOffset">
<WidgetAttr/>
<Text>
<![CDATA[${i18n('SetPrinterOffset')}]]></Text>
<IconName>
<![CDATA[setprinteroffset]]></IconName>
</Widget>
</ToolBar>
</ToolBarManager>
</ToolBars>
<WebPage isPage="false" isShowAsImage="false" isAutoScale="false" isTDHeavy="false"/>
</WebPageContent>
</ReportWebAttr>
<Report class="com.fr.report.WorkSheet" name="sheet1">
<ReportPageAttr>
<HR F="0" T="7"/>
<FR F="10" T="10"/>
<HC/>
<FC/>
<UPFCR COLUMN="false" ROW="true"/>
</ReportPageAttr>
<RowHeight defaultValue="723900">
<![CDATA[914400,914400,914400,914400,914400,914400,914400,914400,914400,914400,914400,723900]]></RowHeight>
<ColumnWidth defaultValue="2743200">
<![CDATA[0,576000,2628900,2160000,2743200,2160000,2160000,3048000,2880000,2880000,2880000,2880000,2880000,2880000,2743200,2160000,2880000,2438400,2743200]]></ColumnWidth>
<CellElementList>
<C c="2" r="0" cs="16" s="0">
<O t="DSColumn">
<Attributes dsName="ds2" columnName="F_CN_ReportShowName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="2" r="1" cs="16" s="1">
<O>
<![CDATA[验光师工作量统计]]></O>
<Expand/>
</C>
<C c="2" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="5" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="6" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="7" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="8" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="9" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="10" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="11" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="12" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="13" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="15" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="16" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="17" r="2">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 0]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="0" r="3">
<Expand/>
</C>
<C c="1" r="3">
<Expand/>
</C>
<C c="2" r="3" s="2">
<O>
<![CDATA[部门名称：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="3" cs="15" s="3">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="queryWay"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand dir="0"/>
</C>
<C c="0" r="4">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="1" r="4">
<Expand/>
</C>
<C c="2" r="4" s="2">
<O>
<![CDATA[查询方式：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="0" r="5">
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性2]]></Name>
<Condition class="com.fr.data.condition.ObjectCondition">
<Compare op="0">
<O>
<![CDATA[]]></O>
</Compare>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.ValueHighlightAction">
<O>
<![CDATA[所有部门]]></O>
</HighlightAction>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="1" r="5">
<Expand/>
</C>
<C c="2" r="5" s="2">
<O>
<![CDATA[查看分类：]]></O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand/>
</C>
<C c="3" r="5" cs="15" s="3">
<O t="DSColumn">
<Attributes dsName="ds3" columnName="lookWay"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<HighlightList>
<Highlight class="com.fr.report.cell.cellattr.highlight.DefaultHighlight">
<Name>
<![CDATA[条件属性1]]></Name>
<Condition class="com.fr.data.condition.FormulaCondition">
<Formula>
<![CDATA[$isShow = 1]]></Formula>
</Condition>
<HighlightAction class="com.fr.report.cell.cellattr.highlight.RowHeightHighlightAction"/>
</Highlight>
</HighlightList>
<Expand dir="0"/>
</C>
<C c="0" r="6">
<Expand/>
</C>
<C c="1" r="6">
<Expand/>
</C>
<C c="2" r="6" rs="2" s="4">
<O>
<![CDATA[验光门店]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="3" r="6" rs="2" s="5">
<O>
<![CDATA[验光数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[1]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[2]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="4" r="6" rs="2" s="5">
<O>
<![CDATA[双眼视功能]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[27]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[28]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="5" r="6" rs="2" s="5">
<O>
<![CDATA[处方数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[3]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[4]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="6" r="6" rs="2" s="5">
<O>
<![CDATA[配镜数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[5]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[6]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="7" r="6" rs="2" s="5">
<O>
<![CDATA[打印处方数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[7]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[8]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="8" r="6" rs="2" s="5">
<O>
<![CDATA[镜片]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[9]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[10]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="9" r="6" rs="2" s="5">
<O>
<![CDATA[镜架]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[11]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[12]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="10" r="6" rs="2" s="5">
<O>
<![CDATA[隐形]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[13]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[14]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="11" r="6" rs="2" s="5">
<O>
<![CDATA[老花镜]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[15]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[16]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="12" r="6" rs="2" s="5">
<O>
<![CDATA[视光]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[17]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[18]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="13" r="6" cs="2" s="4">
<O>
<![CDATA[配镜单]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="15" r="6" rs="2" s="5">
<O>
<![CDATA[检查数]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[21]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[22]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="16" r="6" rs="2" s="5">
<O>
<![CDATA[检查金额]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[23]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[24]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="17" r="6" rs="2" s="5">
<O>
<![CDATA[西药费]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[25]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[26]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="13" r="7" s="5">
<O>
<![CDATA[商品金额]]></O>
<NameJavaScriptGroup>
<NameJavaScript name="从小到大">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[19]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
<NameJavaScript name="从大到小">
<JavaScript class="com.fr.base.js.ParameterJavaScript">
<Parameters>
<Parameter>
<Attributes name="order"/>
<O>
<![CDATA[20]]></O>
</Parameter>
</Parameters>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand order="2"/>
</C>
<C c="14" r="7" s="6">
<O>
<![CDATA[附加费用]]></O>
<Expand/>
</C>
<C c="0" r="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="displayName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0" order="2">
<SortFormula>
<![CDATA[SWITCH($order, "1", -TODOUBLE(D9), "2", TODOUBLE(D9), "3", -TODOUBLE(F9), "4", TODOUBLE(F9), "5", -TODOUBLE(G9), "6", TODOUBLE(G9), "7", -TODOUBLE(H9), "8", TODOUBLE(H9), "9", -TODOUBLE(I9), "10", TODOUBLE(I9), "11", -TODOUBLE(J9), "12", TODOUBLE(J9), "13", -TODOUBLE(K9), "14", TODOUBLE(K9), "15", -TODOUBLE(L9), "16", TODOUBLE(L9), "17", -TODOUBLE(M9), "18", TODOUBLE(M9), "19", -TODOUBLE(N9), "20", TODOUBLE(N9), "21", -TODOUBLE(P9), "22", TODOUBLE(P9), "23", -TODOUBLE(Q9), "24", TODOUBLE(Q9), "25", -TODOUBLE(R9), "26", TODOUBLE(R9), "27", -TODOUBLE(E9), "28", TODOUBLE(E9))]]></SortFormula>
</Expand>
</C>
<C c="1" r="8">
<Expand/>
</C>
<C c="2" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="departmentName"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper">
<Attr divideMode="1"/>
</RG>
<Result>
<![CDATA[$$$]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="categoryid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$categoryid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="bgndate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="enddate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="customAmountName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=E5]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="ShopCodeName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="queryWay"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=D5]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="lookWay"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=D6]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="iscustomize"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$iscustomize]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="brandbarcode"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=D10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="sprice"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=G10]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="salerid"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="posid"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="viewname"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$viewname]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="queryPersonID"/>
<O>
<![CDATA[]]></O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[var DataURL = "report.action?reportlet=sales_optometryWorkOnlyStoreRpt.cpt&__bypagesize__=false&categoryid="+categoryid+"&bgndate="+bgndate+"&enddate="+enddate+"&departmentid="+departmentid+"&customAmountName="+EncodeUtf8(customAmountName)+"&ShopCodeName="+EncodeUtf8(ShopCodeName)+"&queryWay="+EncodeUtf8(queryWay)+"&lookWay="+EncodeUtf8(lookWay)+"&showCompanyName="+EncodeUtf8(showCompanyName)+"&isShow="+isShow+"&iscustomize="+iscustomize+"&brandbarcode="+brandbarcode+"&sprice="+sprice+"&salerid="+salerid+"&posid="+posid+"&viewname="+EncodeUtf8(viewname)+"&queryPersonID="+queryPersonID+"&logincompanyid="+logincompanyid;

openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0" order="2">
<SortFormula>
<![CDATA[SWITCH($order, "1", -G10, "2", G10, "3", -H10, "4", H10, "5", -I10, "6", I10, "7", -K10, "8", K10, "9", -M10, "10", M10)]]></SortFormula>
</Expand>
</C>
<C c="3" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="ygksNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="4" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="dcnum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="5" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="pNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="6" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="pjdNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="7" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="dycfNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[IF($$$>0,$$$,0)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="8" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="gSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[3]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentids"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[
var DataURL = "report.action?reportlet=sales_optometryWorkManyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&departmentids="+departmentids+"&endDate="+endDate+"&departmentName="+EncodeUtf8(departmentName)+"&departmentid="+departmentid+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;

openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="9" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="fSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[1]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentids"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[
var DataURL = "report.action?reportlet=sales_optometryWorkManyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&departmentids="+departmentids+"&endDate="+endDate+"&departmentName="+EncodeUtf8(departmentName)+"&departmentid="+departmentid+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;
openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="10" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="hSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[4]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentids"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[
var DataURL = "report.action?reportlet=sales_optometryWorkManyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&departmentids="+departmentids+"&endDate="+endDate+"&departmentName="+EncodeUtf8(departmentName)+"&departmentid="+departmentid+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;

openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="11" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="lSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[8]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentids"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[
var DataURL = "report.action?reportlet=sales_optometryWorkManyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&departmentids="+departmentids+"&endDate="+endDate+"&departmentName="+EncodeUtf8(departmentName)+"&departmentid="+departmentid+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;

openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="12" r="8" s="7">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="sSum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<NameJavaScriptGroup>
<NameJavaScript name="JavaScript2">
<JavaScript class="com.fr.base.js.JavaScriptImpl">
<Parameters>
<Parameter>
<Attributes name="goodsCategoryId"/>
<O>
<![CDATA[9]]></O>
</Parameter>
<Parameter>
<Attributes name="bgnDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$bgndate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentids"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=A9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="endDate"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$enddate]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=C9]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="departmentid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$departmentid]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="isShow"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$isShow]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="showCompanyName"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$showCompanyName]]></Attributes>
</O>
</Parameter>
<Parameter>
<Attributes name="logincompanyid"/>
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=$logincompanyid]]></Attributes>
</O>
</Parameter>
</Parameters>
<JSImport>
<![CDATA[js/pengsheng-checkform.js]]></JSImport>
<JSImport>
<![CDATA[js/windowOpen.js]]></JSImport>
<Content>
<![CDATA[
var DataURL = "report.action?reportlet=sales_optometryWorkManyStoreRpt_Details.cpt&__bypagesize__=false&isShow="+isShow+"&goodsCategoryId="+goodsCategoryId+"&bgnDate="+bgnDate+"&departmentids="+departmentids+"&endDate="+endDate+"&departmentName="+EncodeUtf8(departmentName)+"&departmentid="+departmentid+"&showCompanyName="+showCompanyName+"&logincompanyid="+logincompanyid;


openWindowForReport(DataURL);

]]></Content>
</JavaScript>
</NameJavaScript>
</NameJavaScriptGroup>
<Expand dir="0"/>
</C>
<C c="13" r="8" s="8">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(I9:M9))]]></Attributes>
</O>
<Expand dir="0"/>
</C>
<C c="14" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds4" columnName="fjfy"/>
<Condition class="com.fr.data.condition.CommonCondition">
<CNUMBER>
<![CDATA[1]]></CNUMBER>
<CNAME>
<![CDATA[S_OP_OY_ShopCode]]></CNAME>
<Compare op="0">
<ColumnRow column="0" row="8"/>
</Compare>
</Condition>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="15" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="cNum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="16" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="fmoneySum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="17" r="8" s="8">
<O t="DSColumn">
<Attributes dsName="ds1" columnName="xyfsum"/>
<Complex/>
<RG class="com.fr.report.cell.cellattr.core.group.FunctionGrouper"/>
<Result>
<![CDATA[FuncOne($$$)]]></Result>
<Parameters/>
</O>
<Expand dir="0"/>
</C>
<C c="0" r="9">
<Expand/>
</C>
<C c="1" r="9">
<Expand/>
</C>
<C c="2" r="9" s="9">
<O>
<![CDATA[合计：]]></O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="3" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(D9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="4" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(E9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="5" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(F9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="6" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(G9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="7" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(H9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="8" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(I9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="9" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(J9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="10" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(K9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="11" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(L9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="12" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(M9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="13" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(N9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="14" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(O9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="15" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=sum(P9)]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="16" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(Q9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="17" r="9" s="9">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=FuncOne(sum(R9))]]></Attributes>
</O>
<CellGUIAttr printBackground="false" showAsDefault="true"/>
<CellPageAttr/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="0" r="10">
<Expand/>
</C>
<C c="1" r="10">
<Expand/>
</C>
<C c="2" r="10" s="3">
<O>
<![CDATA[打印日期：]]></O>
<CellPageAttr pageAfterRow="true"/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="3" r="10" cs="4" s="3">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[=today()]]></Attributes>
</O>
<Expand/>
</C>
<C c="7" r="10" s="2">
<CellPageAttr pageAfterRow="true"/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="8" r="10" s="2">
<CellPageAttr pageAfterRow="true"/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="9" r="10" s="2">
<CellPageAttr pageAfterRow="true"/>
<CellInsertPolicy/>
<Expand/>
</C>
<C c="10" r="10">
<Expand/>
</C>
<C c="11" r="10">
<Expand/>
</C>
<C c="12" r="10">
<Expand/>
</C>
<C c="13" r="10">
<Expand/>
</C>
<C c="15" r="10" cs="3" s="10">
<O t="Formula" class="Formula">
<Attributes>
<![CDATA[="页次:第 " + $$page_number + " 页/共 " + $$totalPage_number + " 页"]]></Attributes>
</O>
<CellPageAttr pageAfterRow="true"/>
<CellInsertPolicy/>
<Expand/>
</C>
</CellElementList>
<ReportAttrSet>
<ReportSettings headerHeight="0" footerHeight="0">
<PaperSetting orientation="1">
<Margin top="986400" left="0" bottom="986400" right="0"/>
</PaperSetting>
</ReportSettings>
<Header reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Header>
<Footer reportPageType="0">
<Background name="NullBackground"/>
<LeftList/>
<CenterList/>
<RightList/>
</Footer>
</ReportAttrSet>
</Report>
<ReportParameterAttr>
<Attributes showWindow="false" delayPlaying="true" windowPosition="1" align="1"/>
<PWTitle>
<![CDATA[参数]]></PWTitle>
</ReportParameterAttr>
<StyleList>
<Style horizontal_alignment="2" imageLayout="1">
<FRFont name="黑体" style="1" size="112"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="120"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="2" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72" foreground="-16776961" underline="1"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1" color="-16777216"/>
<Bottom style="1" color="-16777216"/>
<Left style="1" color="-16777216"/>
<Right style="1" color="-16777216"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="ColorBackground" color="-4144960"/>
<Border/>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72" foreground="-16776961" underline="1"/>
<Background name="NullBackground"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="SimSun" style="0" size="72"/>
<Background name="NullBackground"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="0" imageLayout="1">
<FRFont name="黑体" style="1" size="72" foreground="-65536"/>
<Background name="ColorBackground" color="-4144960"/>
<Border>
<Top style="1"/>
<Bottom style="1"/>
<Left style="1"/>
<Right style="1"/>
</Border>
</Style>
<Style horizontal_alignment="4" imageLayout="1">
<FRFont name="黑体" style="1" size="72"/>
<Background name="NullBackground"/>
<Border/>
</Style>
</StyleList>
</WorkBook>
